/*
 * UVerify Backend
 * Copyright (C) 2025 Fabian Bormann
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program. If not, see <http://www.gnu.org/licenses/>.
 */

package io.uverify.backend.util;

import com.bloxbean.cardano.client.api.exception.ApiException;
import com.bloxbean.cardano.client.api.model.Result;
import com.bloxbean.cardano.client.api.model.Utxo;
import com.bloxbean.cardano.client.backend.api.BackendService;
import com.bloxbean.cardano.client.backend.model.TxContentOutputAmount;
import com.bloxbean.cardano.client.backend.model.TxContentUtxo;
import com.bloxbean.cardano.client.backend.model.TxContentUtxoOutputs;
import com.bloxbean.cardano.client.plutus.blueprint.PlutusBlueprintUtil;
import com.bloxbean.cardano.client.plutus.blueprint.model.PlutusVersion;
import com.bloxbean.cardano.client.plutus.spec.*;
import com.bloxbean.cardano.client.transaction.spec.TransactionOutput;
import com.bloxbean.cardano.client.util.HexUtil;
import com.bloxbean.cardano.yaci.store.common.domain.AddressUtxo;
import com.bloxbean.cardano.yaci.store.common.domain.Amt;
import io.uverify.backend.enums.CardanoNetwork;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.codec.binary.Hex;
import org.apache.commons.codec.digest.DigestUtils;
import scalus.bloxbean.ScalusScriptUtils;

import java.math.BigInteger;
import java.nio.charset.StandardCharsets;
import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

@Slf4j
public class ValidatorUtils {
    public final static String PROXY_TX_HASH = "";
    public final static Integer PROXY_OUTPUT_INDEX = 0;

    public static String getProxyStateTokenName(String txHash, int outputIndex) {
        // Convert hex string to bytes
        byte[] txHashBytes;
        try {
            txHashBytes = Hex.decodeHex(txHash.toCharArray());
        } catch (java.lang.Exception exception) {
            log.error(exception.getMessage());
            return "";
        }
        // Convert outputIndex to string and then to bytes
        String outputIndexString = String.valueOf(outputIndex);
        byte[] outputIndexBytes = outputIndexString.getBytes(StandardCharsets.UTF_8);

        // Combine both byte arrays
        byte[] messageBuffer = new byte[txHashBytes.length + outputIndexBytes.length];
        System.arraycopy(txHashBytes, 0, messageBuffer, 0, txHashBytes.length);
        System.arraycopy(outputIndexBytes, 0, messageBuffer, txHashBytes.length, outputIndexBytes.length);

        // Calculate SHA3-256 hash and return as hex string
        return DigestUtils.sha3_256Hex(messageBuffer);
    }

    public static String getMintOrBurnAuthTokenCode(CardanoNetwork network) {
        if (network.equals(CardanoNetwork.MAINNET)) {
            return "5901f801010032323232323232253330023232323232323232323253233300d3370e900000309919192999809980b0010992999808a99980898028008a5113370e00290008a999808980298041bac30073013375401c26600c6eb0c01cc04cdd500724411c81c0d7f845fb2cf5d23453dc63997595688973c860786503c4d47b11001616375a60240022c602800264a66601e600660206ea800452f5bded8c026eacc050c044dd500099198008009bab301430153015301530153011375401844a6660260022980103d87a800013232323253330143372200e0042a66602866e3c01c0084cdd2a4000660306e980052f5c02980103d87a80001330060060033756602a0066eb8c04c008c05c008c054004dd7180918079baa0071533300d300100613232325333010300430073758600c60246ea80344cc014dd6180318091baa00d48811c81c0d7f845fb2cf5d23453dc63997595688973c860786503c4d47b110016301430150023013001300f375400e2c6e1d200222323300100100322533301200114a0264a66602066e3cdd7180a8010020a5113300300300130150012301030113011301130113011301130113011001300100122533300d0011480004cdc02400466004004602000260106ea8004c02cc030008c028004c028008c020004c010dd50008a4c26cacae6955ceaab9e5573eae815d0aba201";
        }
        return "5901f801010032323232323232253330023232323232323232323253233300d3370e900000309919192999809980b0010992999808a99980898028008a5113370e00290008a999808980298041bac30073013375401c26600c6eb0c01cc04cdd500724411c11bcb8e4a79304e23bcd5e2bf628907f9b998f43902f41d1db439981001616375a60240022c602800264a66601e600660206ea800452f5bded8c026eacc050c044dd500099198008009bab301430153015301530153011375401844a6660260022980103d87a800013232323253330143372200e0042a66602866e3c01c0084cdd2a4000660306e980052f5c02980103d87a80001330060060033756602a0066eb8c04c008c05c008c054004dd7180918079baa0071533300d300100613232325333010300430073758600c60246ea80344cc014dd6180318091baa00d48811c11bcb8e4a79304e23bcd5e2bf628907f9b998f43902f41d1db4399810016301430150023013001300f375400e2c6e1d200222323300100100322533301200114a0264a66602066e3cdd7180a8010020a5113300300300130150012301030113011301130113011301130113011001300100122533300d0011480004cdc02400466004004602000260106ea8004c02cc030008c028004c028008c020004c010dd50008a4c26cacae6955ceaab9e5573eae815d0aba201";
    }

    public static String validatorToScriptHash(PlutusScript script) {
        try {
            return HexUtil.encodeHexString(script.getScriptHash());
        } catch (Exception e) {
            log.error("Error computing policy id: " + e.getMessage());
            return null;
        }
    }

    public static PlutusScript getUVerifyStateContract() {
        String compiledCode = "5915190101002229800aba2aba1aba0aab9faab9eaab9dab9a9bae0039bae002488888888966002646465300130073754003370e90024dc3a4001300b0039805801244444b30013004005899912cc004c014c038dd5001c4c8ca60026eb4c050006602a003375c60280049112cc004c06000a26600c6eb0c05c008896600200519800980b1baa00b911919800800801912cc004006297ae0899912cc004c01400a26603c004660080080031330040040014068603a002603c00280da460346036003370090014dc3a4005223232330010010042259800800c00e2646644b30013372200e00515980099b8f0070028800c01901c44cc014014c08801101c1bae301b00137566038002603c00280e052f5bded8c12301a301b301b301b301b301b301b301b301b301b301b0019180d180d980d980d800c8c068c06cc06c006460346036603660366036603660360032301a301b301b301b301b001911919800800801912cc00400629422b30013003301d0018a51899801001180f000a030406d374a900048c068c06cc06cc06cc06cc06cc06cc06c00644646600200200644b30010018a508acc004cdc79bae301d0010038a51899801001180f000a030406d3710900048c068c06cc06cc06cc06cc06c00646034603660366036603660366036603660360032301a301b301b301b301b301b301b301b301b301b0014888888888888888888a6002605a027375860580272259800800c5200089809198010011817800a0589119192cc004c04c006264b30013014302d3754602c605c6ea8c058c0b8dd5002c4cdc400080244cdc48008022058375a6060605a6ea800a2b300130240018a508a5140ac8158c0acdd5000981718159baa3013302b37540052259800800c5200089809198010011817800a0589119803801000c8c014dc6800c8966002604260546ea800a2646464646464646464646530013259800981b800c56600266e25200430360018b44c074c0d80050354590381baa30390019bae303900b9bae303900a9bad30390099bad30390089bad30390069bad30390059bae30390049bad30390039bae3039002488888888896600260880171330323758608602244b300100280c44c8c008c11c00cdd7182280120868b2082181c800981c000981b800981b000981a800981a000981980098190009818800981800098159baa0028b205292cc004006298103d87a800089804198161816800a5eb8102b4888c8cc88cc008008004896600200300389919912cc004cdc8803801456600266e3c01c00a200300640c1133005005303600440c06eb8c0bc004dd698180009819000a0603301200400314800122222222229800981b8054dd6181b0054cc0700248cdd7981b981a1baa303730343754603860686ea8004cdd2a40046606c6ea40c52f5c130080089803003488966002646600200200644b30010018a518acc004c96600260146eb8c0f0c0e4dd5000c56600260146eb8c06cc0e4dd5000c4cc02c010dd7180d981c9baa0018a5040dd14a081b8c0ec006266004004607800314a081b103944cdc78019b92329800800c00e911004004444b30010028800c66002007303d00299b8a0013232323371466e28cdc51bae303f00337306e64dd7181f8011bae303f001329800800cdd61820182080152201004004444b30010028800c66002007304300299b8a00137306e64dd7182100120064100607e002607c00260726ea8c0f000900320748a5040d09111114c004c0f4c0f401a6eb0c0f001a64b300130300018a508acc004c08000629462c81c103818018024896600260626eb4c078c0ecdd5000c528c56600260626eb4c074c0ecdd5000c528c566003300130313370c60446eb4c070c0ecdd50009bad301e303b37540034a14a281ca2946264660020026eb0c070c0f0dd5001112cc00400629462b3001323301d00525980099baf3027303f37540026e98c966002606c00314bd6f7b63044c8c8cc0040052f5bded8c044b300100189982299bb04c01014000374c00697adef6c608994c004dd71821800cdd59822000cc1200092225980099b904890000389982499bb04c01014000374c00e00b15980099b8f4890000389982499bb04c01014000374c00e003133049337606ea400cdd300119803003000a08a411430460014110646600200297adef6c602259800800c4cc110cdd8261014000375000697adef6c608994c004dd71821000cdd69821800cc11c0092225980099b904890000389982419bb04c01014000375000e00b15980099b8f4890000389982419bb04c01014000375000e003133048337606ea400cdd400119803003000a08841103045001410c81f0cdc19bad3021303f375400a60106eb0c07cc0fcdd5002c4cdd79821181f9baa3042303f3754002603a660826ea40092f5c114a081e8dd71820000c4cc008008c104006294103b207c40e481c90392444465300130410019bac30413042001cc00566002660466eacc1040140ee2946294103f528528a078488966002b30010018cc004cc098dd5981098209baa03603e91118154c00400e0050014049223233001001330290030022259800800c52844c8c96600266008008609600714a31302d375a608e0048228dd718228009824000a08c918101982219ba548008cc110dd4800a5eb80cc11130103d87a80004bd704dd7182218209baa03592cc00400629462941043496600200314c0103d87a800089810198221822800a5eb810432444444464b30013371e91010e6d696e745f626f6f747374726170000048992cc004c100c124dd5000c4c966002608460946ea8006264b30013042304b37540031323232323232323298009bad30570019bae30570079bad30570069bad30570059bac30570049bad30570039bad3057002488888896600260be01113304d375860bc01e44b3001002899827802912cc00400a264b30013056305f375400315980098231919800800810112cc0040062900044c124cc008008c198005063456600266e3c02cdd7183198301baa0018acc004cdc42400400d159800981d806456600260346eb0c108c180dd502a4566002608c60540311330320214891c11bcb8e4a79304e23bcd5e2bf628907f9b998f43902f41d1db439981008a50417914a082f2294105e452820bc8a50417914a082f22c82f0c060c8cc00400407c896600200314bd7044cc18cc180c190004cc008008c19400506244c8c008c19000cdd7183100120c0899180118310019bae306000241791641703057001305600130550013054001305300130520013051001304c3754003164128609c60966ea80062c8248c134c138c138c128dd5182698251baa0018b20903018001899912cc004cdc7a450a6d696e745f7374617465000068992cc004c108c12cdd5000c4c966002608860986ea80062646603c00226464b30013046304f37540031323259800982498289baa00189919804800899192cc004c12cc150dd5000c4c9660026078603e007159800acc004c130c07c006294626078603e00282a22b30013371e6eb8c164c158dd50011bae305930563754013159800991981b01691919b8f372466e28dd7182e000cc00528520049bad305c305d0015e4800cc160dd5182d982c1baa001375c60b260ac6ea80262b3001980098081bac3038305637540954a14a282a22b300198009bae3033305637540133758607060ac6ea812a02e80f22b3001303c98009bab303e30563754607c60ac6ea801a0a7375c607c60ac6ea80110244566002b3001598009bac30593056375400914a314a082ba29462660646eb0c164c158dd50021bae303e3056375401282a22b30015980099b8f375c607c60ac6ea8024dd7181f182b1baa0098acc004cdc39bad3038305637540126eb4c0e0c158dd5002456600266e1cdd6981c982b1baa009375a607260ac6ea80122b30013375e606c60ac6ea8024c0d8c158dd5002456600266e1cdd69818182b1baa009375a606060ac6ea80122b30013370e6eb4c0bcc158dd50049bad30333056375400915980099b8f375c605c60ac6ea8024dd7181f182b1baa004899b87375a606e60ac6ea8024cdc01bad3037305637540089000c52820a88a50415114a082a22941054452820a88a50415114a082a22b3001303c302000e8acc004c0f0c0800222b30013301a01c0098acc004cc0a8c0ccc158dd50259bad3030305637540131598009981400b9bae303e3056375401313371260406eb0c0e0c158dd50251bad302f3056375401314a082a22941054452820a88a50415114a082a22941054452820a88a50415114a082a22941054452820a88a50415114a082a229410541980600a2400316414c601a002660140249001182a98291baa0018b20a0303330513754607260a26ea8004c14cc140dd5000c5904e180f0009981b80d12cc004cdd7982918279baa3037304f37540026016099159800998061bab3037304f3754606e609e6ea80041323300198009bab3037304f3754606e609e6ea800609904b40354a14a2826a294104d4528209a3050304d375400316412c609e60a060a060986ea8c13cc130dd5000c5904a180d001c4c96600266e3d22010e6275726e5f626f6f7473747261700000789919912cc004c114c138dd500144c8c966002608e60a06ea8006264b30013049305137540031323300900115980098069bac30353053375408f1598009824980e002c5660026072603800f15980099b8f375c607660a66ea80040122b3001300d00b89981280a2451c11bcb8e4a79304e23bcd5e2bf628907f9b998f43902f41d1db439981008a50414514a0828a2941051452820a28a50414460aa60a46ea80062c8280c0ccc144dd5181c98289baa30543051375400316413c6600a04c4606f30013756607260a26ea8c0e4c144dd5000c13a00480f8dd7182918279baa0028b209a30060013300400c48008cc00c02d20018acc004cdc7a450a6275726e5f73746174650000789919912cc004c114c138dd500144c8c966002608e60a06ea8006264b3001304930513754003132330230011598009981280a1bae303b3053375400315980099b8f004375c60ac60a66ea80062b30019800981c98291baa3037305337540034a14a2828a2b3001300d3758606a60a66ea811e2b30013049301c0058acc004c0e4c07001e2601a01714a0828a2941051452820a28a50414514a0828a2941051182a98291baa0018b20a0303330513754607260a26ea8c150c144dd5000c5904f198028131181bcc004dd5981c98289baa30393051375400304e801203e375c60a4609e6ea800a2c8268c018004cc01003120023300300b48006294104a20942232330010010032259800800c530103d87a80008992cc004c0100062605c660a400297ae0899801801982a001209c30520014140824888c8cc00400400c896600200314bd7044ca60026eb8c1340066eb4c13800660a40049112cc004cdc380380144cc14cdd480199803003000c4cc01801800504f0c14000504e112cc004c104c128dd500144c8c8c8c8c8c8c8ca60026eb4c1580066eb8c15801e6eb4c15801a6eb4c1580166eb0c1580126eb4c15800e6eb4c158009222222259800982f00444cc130dd6182e807912cc00400a26609c00a44b300100280a44c8c008c18c00cdd7183080120be899180118308019bae305f002417516416c3056001305500130540013053001305200130510013050001304b37540051641248238cc0c403896600266ebcc130c124dd5000980282345660026600c6eacc0c4c124dd500082346600330013756606260926ea800608d045401d4a14a2823a29410474528208e4528a07e8acc0056600200d13259800981c18209baa001899192cc004c0ecc10cdd5000c4cc896600266e3d2210e6275726e5f626f6f747374726170000018803456600266e3d2210a6275726e5f7374617465000018803456600266e3d2210c7570646174655f73746174650000189980b0010992cc004c0b4c118dd5000c4c8c8c8cc8966002608460966ea800a26464b30013045304d37540031323301f001159800998108081bae3037304f375401715980099baf3052304f375400660a4609e6ea8c0dcc13cdd5006c566002606a603200d159800981a8024566002606b30013756606e609e6ea800e011375c60a4609e6ea802d01d4566002606b30013756606e609e6ea8c0dcc13cdd5006c0226eb8c148c13cdd5005a03a8acc0056600260546eb4c0c0c13cdd5005c4cc08c044dd6981498279baa00b8a504135159800acc0066002606a609c6ea8c0ccc13cdd5005d28528a09a8acc004cdc79bae3052304f37540026eb8c148c13cdd5005c56600266e3cdd7181b98279baa001375c606e609e6ea802e2b30013370e6eb4c0c4c13cdd50009bad3031304f375401715980099b87375a6064609e6ea8004dd6981918279baa00b8acc004cdd7981798279baa001302f304f375401715980099b87375a6052609e6ea8004dd6981498279baa00b8acc004cdc39bad3028304f37540026eb4c0a0c13cdd5005c56600266e3cdd7181398279baa001375c604e609e6ea802e266e1cdd6981818279baa001337006eb4c0c0c13cdd5005a400314a0826a294104d4528209a8a50413514a0826a294104d4528209a8a50413514a0826a2b3001330130150018acc004cdc4980c9bac3031304f37540866eb4c0a0c13cdd5000c660026eb8c0b0c13cdd5000cdd6181898279baa043808202e8a50413514a0826a294104d4528209a8a50413514a0826a294104d4528209a8a50413514a08268c144c138dd5000c5904c181798269baa001304f304c37540051641286032002646600200200644b30010018a40011332259800981a4c004dd5981b18271baa002803cdd7182898271baa00a4071130350018800a098304f001330020023050001413466064002530013375e605860946ea800530103d8798000a50a5141206606201c464b300130303049375400313371e0066eb8c134c128dd5000c5282090304c30493754609860926ea8004dd7182518239baa0018b208a3049304637546092608c6ea8c0b8c118dd50024528208841108220c11cc110dd50009bae304730443754071164108604a60866ea8c0acc10cdd5000982298211baa0018b2080301000c8a5140fd159800800c528c401903f4528207e8a5040fc30413041304100408992cc004c034c058dd5000c4c8c8ca60026eb8c074006603c003375c603a00737326eb8c0740092222598009811001c4cc040dd61810801912cc00400a2601660480191323002302500337326eb8c08c00902145901f0c074004c070004c05cdd5000c59015180c801202e8b202a180a00098079baa0038b201a3010300d375400c4464660020020064466006002600400515980099b874801801626464b30013005300e37546024602600514a31640346eb4c044004c034dd500345900b201618051805800980500098029baa00a8a4d13656400c01";
        return PlutusBlueprintUtil.getPlutusScriptFromCompiledCode(compiledCode, PlutusVersion.v3);
    }

    public static PlutusScript getUVerifyStateContract(String scriptHash, String proxyTokenName) {
        PlutusScript plainScript = getUVerifyStateContract();

        String parameterizedScript = ScalusScriptUtils.applyParamsToScript(plainScript.getCborHex(),
                BytesPlutusData.of(HexUtil.decodeHexString(scriptHash)),
                BytesPlutusData.of(HexUtil.decodeHexString(proxyTokenName)));
        return PlutusV3Script.builder().cborHex(parameterizedScript).build();
    }

    public static PlutusScript getUVerifyStateContract(String txHash, int outputIndex) {
        PlutusScript proxyContract = getUverifyProxyContract(txHash, outputIndex);
        String proxyScriptHash = validatorToScriptHash(proxyContract);

        if (proxyScriptHash == null) {
            throw new IllegalArgumentException("Script hash of proxy contract is null");
        }

        String proxyTokenName = getProxyStateTokenName(txHash, outputIndex);

        PlutusScript plainScript = getUVerifyStateContract();

        String parameterizedScript = ScalusScriptUtils.applyParamsToScript(plainScript.getCborHex(),
                BytesPlutusData.of(HexUtil.decodeHexString(proxyScriptHash)),
                BytesPlutusData.of(HexUtil.decodeHexString(proxyTokenName)));
        return PlutusV3Script.builder().cborHex(parameterizedScript).build();
    }

    public static PlutusScript getUVerifyProxyContract() {
        String compiledCode = "590aa4010100229800aba4aba2aba1aba0aab9faab9eaab9dab9a488888889660033001300337540132232330010010032259800800c528456600266e3cdd71805000801c528c4cc008008c02c0050052010911919800800801912cc00400629422b30013375e601400200714a3133002002300b0014014804244b30010018a5eb8226600e6008601000266004004601200280326e1d20009180398041804000cdd2a4001374a9001488c8cc00400400c896600200314bd7044cc8966002600a00513300b00233004004001899802002000a00e300a001300b00140212259800800c52f5c1133007300430080013300200230090014019370e900148c01cc020006444b3001337120049000440063300100399b840024805266e2ccdc019b85002480512060001400c80224444646600200200a44b30010018802c4c966002003133004300d002006899802980680119801801800a016300d0014029370e900224444444444444453001301600f980a807c88cc04000800660180192259800980698099baa0028991919912cc004c07000e00b1640646eb8c064004dd7180c801180c800980a1baa0028b202492cc0040062980103d87a8000898051980a980b000a5eb8101448c028cc054c024cc054dd4800a5eb80cc05530103d87a80004bd704c01801a4464b300130083014375400314bd6f7b63044dd5980c180a9baa001404c646600200200644b30010018a60103d87a8000899192cc004cdc8802800c56600266e3c0140062601e66034603000497ae08a60103d87a80004059133004004301c00340586eb8c058004c0640050174c00c00d222222222233223232980091b9933002375000291010098118074c07cdd50022444b3001301c00189919912cc004c07c0062b30013026375400b0028b204e8acc004c0640062b30013026375400b0028b204e8b2048409026464646465300137566058003372666e28dd7181618149baa030373060126eb4c06cc0a4dd50184dd598160012444b3001301f302b375401715980099198008009bac30300092259800800c528456600266ebcc0c4c0b8dd5181880081ac528c4cc008008c0c800502c205e899192cc004c09cc0b4dd5000c4c966002603c605c6ea8006264b30013029302f37540031323259800981b000c4c8cc8966002605c60686ea800a2b3001302832330010010042259800800c52000899b8048008cc008008c0ec00503845660026050646600200201444b30010018a4001133700900119801001181d800a0708acc004cdc79bae303830353754004017133021375860706072607201a6eb8c0e00122941033452820668a5040cd1640cc64b30010018a6103d87a8000898159981b181b800a5eb81035180d0009bae30360033301800700f8b20663035001303037540031640b86064605e6ea80062c8168c0c4c0c8c0c8c0b8dd5181898171baa0018b20583016001330213758605e00c4b30013375e6060605a6ea8004c05402a26605264660020026eacc080c0b8dd5001112cc004006297ae089981898171819000998010011819800a06000a8a5040ad1640a91332259800981398169baa0018992cc004c078c0b8dd5000c4c8cc06800456600330013302c004006a50a5140b913302b301b00730263303230333030375400297ae08a5040b86064605e6ea80062c8168c098c0b8dd5181018171baa3031302e37540031640b0602666024002012602a660426eb0c0bc01c966002660526028660266eacc07cc0b4dd5180f98169baa00100a003899baf3030302d3754603e605a6ea8004c05402a294102b205418161816000981598158009815000981480098121baa011302337540066eb8c098c08cdd5003c566002602c003132329800899911919194c004dd59816800cdd6181698171817000ccc010dd61816802919baf302e302b375400200e9112cc004c098c0b0dd5000c4c8c9660026044605c6ea800633001375c6064605e6ea80066066605e6ea8c084c0bcdd50014dc999b8a375c6064605e6ea80d8dcc18079bad3021302f375406c91119912cc004c09cc0ccdd5009c4c966002605c60686ea8006264b3001302530353754003132598009818181b1baa001899192cc004c0f400626644b3001302a303a375401313259800981a981d9baa001899192cc004c10800626644b30019800806d28528a07c8acc004cc0b00540062b30013371e00c00314a313302c01500640f914a081f2294103e1bae3041002375c60820031640fc608200260786ea80062c81d0c0f8c0ecdd5004c590391bae303c002375c60780031640e86078002606e6ea80062c81a8c0e4c0d8dd5000c59034181c181c981c981a9baa3038303537540031640cc6601c6eb0c0dc030966002660626038660366eacc09cc0d4dd500080300244cdd7981c181a9baa001301d0068a5040cd132598009817181a1baa0018992cc004c094c0d4dd5000c4c8cc084004566002009133032302200d302d33039303a3037375400297ae08a5040d46072606c6ea80062c81a0c0b4c0d4dd51813981a9baa3038303537540031640cc603a660526eb0c0dc034966002660626038660366eacc09cc0d4dd51813981a9baa001006004899baf303830353754604e606a6ea8004c07401a2941033206430353036002980099817180c9980c1bab3035002003001a50a5140c08b205a3031302e37546062605c6ea8c080c0b8dd5000981818169baa0018b205618169816981698168009816000981580118129baa0122232330010010032259800800c530103d87a80008992cc004c010006260426605800297ae089980180198170012050302c00140a93024375400930283029002488966002604200515980098141baa007801c590294566002603600515980098141baa007801c59029459026204c181380098119baa0078b2042408430010012223259800801c4c8c8cc88cc024008cdc524501280059800800c4cdc52441035b5d2900006899b8a489035b5f20009800800ccdc52441025d2900006914c00402a00530070014029229800805400a0028051016204e5980099b880014803a266e0120f2010018acc004cdc4000a41000513370066e01208014001480362c81110221bac3024002375a60440026466ec0dd418110009ba73023001375400713259800800c4cdc52441027b7d00003899b8a489037b5f20003232330010010032259800800c400e264b30010018994c00402a604e003337149101023a200098008054c0a000600a805100a181500144ca6002015302700199b8a489023a200098008054c0a0006600e66008008004805100a18150012050302a001409c66e29220102207d0000340906eac00e264b3001001899b8a489025b5d00003899b8a489035b5f20009800800ccdc52441015d00003914c00401e0053004001401d229800803c00a002803901320483758007133005375a0060051323371491102682700329800800ccdc01b8d0024800666e292210127000044004444b3001337100049000440062646645300100699b800054800666e2ccdc00012cc004cdc40012402914818229037204e3371666e000056600266e2000520148a40c11481b9027002200c33706002901019b8600148080cdc70020012048375c0068138dc5245022c2000301f302000a2232330010010032259800980c800c4cdc524410130000038acc004cdc4000a40011337149101012d0033002002337029000000c4cc014cdc2000a402866e2ccdc019b85001480512060003407880f08a4d1365640041";
        return PlutusBlueprintUtil.getPlutusScriptFromCompiledCode(compiledCode, PlutusVersion.v3);
    }

    public static PlutusScript getUverifyProxyContract(Utxo utxo) {
        return getUverifyProxyContract(utxo.getTxHash(), utxo.getOutputIndex());
    }

    public static PlutusScript getUverifyProxyContract(String txHash, int outputIndex) {
        PlutusScript plainScript = getUVerifyProxyContract();

        PlutusData outputReference = ConstrPlutusData.of(0,
                BytesPlutusData.of(HexUtil.decodeHexString(txHash)),
                BigIntPlutusData.of(outputIndex));


        String parameterizedScript = ScalusScriptUtils.applyParamsToScript(plainScript.getCborHex(), outputReference);
        return PlutusV3Script.builder().cborHex(parameterizedScript).build();
    }

    public static String getMintOrBurnAuthTokenHash(CardanoNetwork network) {
        if (network.equals(CardanoNetwork.MAINNET)) {
            return "a8172157733dd50ef6f0f8d38e361745037f0a79c1f5da9b1d8079ff";
        }
        return "d3c25617941168e238038f1cf6542229b919bbd6fd2b8292ce176203";
    }

    public static String getMintStateTokenCode(CardanoNetwork network) {
        if (network.equals(CardanoNetwork.MAINNET)) {
            return "590b9301010032323232323232253330023232323232533233008300130093754004264646464646464a666024602a004264646464646464646464a666032601a012264646464646464646464646464646464646464646464a66605e60466030002264a666060605260626ea80044c94ccc0c4c094c0740184c94ccc0c8c0acc0ccdd500089919299981a19b8748010c0d4dd5000899299981a9817181b1baa00113232323232323232323232323232323232323232533304c304f00213302b01322533304e00213302d0092253330500021533304d304133302837566064609e6ea8c0c8c13cdd500da451ca8172157733dd50ef6f0f8d38e361745037f0a79c1f5da9b1d8079ff00375c606a609e6ea806454ccc134cdd7981898279baa3031304f37546064609e6ea806ccdd2a4004660a298011e581ca8172157733dd50ef6f0f8d38e361745037f0a79c1f5da9b1d8079ff004bd70099299982729998271823981b8008a5113303400101e132533304f3043303b001132533305030493051375400226464a6660a466e1d200430533754002264a6660a6609860a86ea80044c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c94ccc1b8c1c40084cc13402c894ccc1c00084cc13c01c894ccc1c800854ccc1bccdc781f9bae30543071375403a2a6660de60c66660946eacc150c1c4dd500f83381f8a99983799baf30533071375460a660e26ea807ccdd2a4004660e6609260e26ea80752f5c02a6660de664464a6660e460cc60e66ea80044c94ccc1ccc19cc1d0dd5182c183a9baa305830753754008266e2000400c4cdc48008019bad3077307437540022940c154c1ccdd5182b18399baa0023048307137540d86eb4c120c1c4dd500e8a999837a99983799b8f375c60a860e26ea80740fc54ccc1bccdc79bae30573071375403a6eb8c150c1c4dd501d8a99983799b8f375c609260e26ea8074dd7182498389baa03b1533306f3370e6eb4c190c1c4dd500e9bad3064307137540762a6660de66e1cdd6982698389baa01d375a609a60e26ea80ec54ccc1bccdd7982718389baa01d304e307137540762a6660de66e1cdd6982418389baa01d375a609060e26ea80ec54ccc1bccdc39bad304f3071375403a6eb4c140c1c4dd501d8a99983799b8f375c60e860ea60ea60ea60ea60ea60ea60ea60ea60ea60ea60ea60e26ea8074dd7182b98389baa03b13370e6eb4c158c1c4dd500e99b80375a60ac60e26ea80ed200114a029405280a5014a029405280a5014a02a6660de66e24c16cdd6182818389baa01d375a609e60e26ea807454ccc1bcc8cc004004dd6182898391baa01e22533307400114a2264a6660e464a6660e660ac6eb8c15cc1d4dd50008a999839982b1bae305b307537540022660b26eb0c168c1d4dd50381bae305b307537540022940528183b8010998018018008a5030770011533306f533306f3068375a609a60e26ea80745288a99983798341bad30643071375403a294454ccc1bcccc1bcc1a0cdc3182e9bad30563071375403a6eb4c134c1c4dd500ea504a229444c8cc004004dd6182798391baa01e22533307400114a2264a6660e464660a008c4a6660e866ebcc164c1d8dd50009ba6325333075306e00114bd6f7b6300991919800800a5eb7bdb180894ccc1ec0044cc1f0cdd82601014000374c00697adef6c60132323232533307c3372091010000213308001337609801014000374c00e00a2a6660f866e3d2210000213308001337609801014000374c00e0062661000266ec0dd48011ba600133006006003375660fa0066eb8c1ec008c1fc008c1f4004c8cc0040052f5bded8c044a6660f40022660f666ec13001014000375000697adef6c60132323232533307b3372091010000213307f337609801014000375000e00a2a6660f666e3d2210000213307f337609801014000375000e0062660fe66ec0dd48011ba800133006006003375a60f80066eb8c1e8008c1f8008c1f0004cdc19bad30693076375404460ba6eb0c14cc1d8dd5011099baf30583076375460b060ec6ea8004c1accc1e0dd480125eb805281bae307700213300300300114a060ee0022646609a08e464646466e3cdc919b8a0023337929412004001005375a60f060f20046eb8c1dc004c1ccdd5182a98399baa001375c60a660e26ea80745280a5014a029405280a5014a029404c94ccc1c0c1a4c1c4dd500089919191919191919299983d983f00109982d00091299983e8010980618400080689918011840808019b99375c60fe0042c6eb0c1f0004c1f0008dd7183d000983d0011b99375c60f000260f00046eb8c1d8004c1c8dd50008b183a0010991801183a0019bae307200216375c60de00260de0046eb4c1b4004c1b4008dd6183580098358011bad30690013069002375a60ce00260ce0046eb0c194004c194008dd6983180098318011bad30610013061002375c60be00260be0046eb8c174004c174008dd7182d800982d8011bae3059001305537540022c60ae60a86ea800458c0e4c14cdd5000982a98291baa00116302b001163303d021233304f3375e606e60a26ea800530103d87980004a094458dd6181898279baa019161613230023054003375c60a4004264600460a40066eb8c14000858dd6982680098268011bad304b001304b002375a609200260920046eb0c11c004c11c008dd6982280098228011bad30430013043002375c608200260820046eb8c0fc004c0fc008dd7181e800981e8011bac303b001303737540022c6072606c6ea800458c06cc0d4dd5180c181a9baa0013037303437540022c601a00c2c6eb8c0d4c0c8dd50008b180d0008b1bac30333034303430343034303430340023758606400260640046eb0c0c0004c0c0008dd6181700098151baa0252302d302e302e302e302e302e302e302e0012302c302d302d302d001222325333029301d302a37540022900009bad302e302b375400264a666052603a60546ea80045300103d87a8000132330010013756605e60586ea8008894ccc0b8004530103d87a8000132323232533302f337220100042a66605e66e3c0200084c098cc0ccdd4000a5eb80530103d87a8000133006006003375a60600066eb8c0b8008c0c8008c0c0004cc07800c00894ccc0a0004530103d87a80001301c33029302a0014bd701119198008008019129998150008a5013253330283004302d00214a2266006006002605a00246050605260526052605260520024604e6050605060506050605060500024604c604e604e604e604e604e604e604e604e604e604e0024604a604c604c604c604c604c604c604c604c604c00244646600200200644660060026004004466e212000371a0024604400246042604400244646600200200644a66604200229404c94ccc07ccdc79bae302400200414a226600600600260480024603e604060406040604060406040604060400022a66603266e1d200100913232533301b301430073300a37586040004466603866ebcc010c078dd5000a60103d87980004a094454ccc06cc03cc0100044c94ccc070c054c074dd5000899b8f00d375c6042603c6ea800458c0180045858dd6180f981018101810181018101810000980f980f980d9baa016162301e301f301f001300100122533301b0011480004c018cc008008c07800494ccc0640045300103d87a80001300d3301a301b0014bd70180080091299980c0008a4000260066600400460360026e01200222323300100100322533301800114bd7009919299980b980280109980d80119802002000899802002000980e001180d0009bad3012002375c60200022c602600264a66601c6004601e6ea800452f5bded8c026eacc04cc040dd5000998019bab3002300f375401400a6e1d200223011301230123012301200122323300100100322533301100114c103d87a800013232323253330123372200e0042a66602466e3c01c0084c024cc058dd3000a5eb80530103d87a8000133006006003375660260066eb8c044008c054008c04c004dd2a40006eb8c034c028dd50011b874800058c02cc030008c028004c028008c020004c010dd50008a4c26cacae6955ceaab9e5573eae815d0aba21";
        }
        return "590b9301010032323232323232253330023232323232533233008300130093754004264646464646464a666024602a004264646464646464646464a666032601a012264646464646464646464646464646464646464646464a66605e60466030002264a666060605260626ea80044c94ccc0c4c094c0740184c94ccc0c8c0acc0ccdd500089919299981a19b8748010c0d4dd5000899299981a9817181b1baa00113232323232323232323232323232323232323232533304c304f00213302b01322533304e00213302d0092253330500021533304d304133302837566064609e6ea8c0c8c13cdd500da451cd3c25617941168e238038f1cf6542229b919bbd6fd2b8292ce17620300375c606a609e6ea806454ccc134cdd7981898279baa3031304f37546064609e6ea806ccdd2a4004660a298011e581cd3c25617941168e238038f1cf6542229b919bbd6fd2b8292ce176203004bd70099299982729998271823981b8008a5113303400101e132533304f3043303b001132533305030493051375400226464a6660a466e1d200430533754002264a6660a6609860a86ea80044c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c94ccc1b8c1c40084cc13402c894ccc1c00084cc13c01c894ccc1c800854ccc1bccdc781f9bae30543071375403a2a6660de60c66660946eacc150c1c4dd500f83381f8a99983799baf30533071375460a660e26ea807ccdd2a4004660e6609260e26ea80752f5c02a6660de664464a6660e460cc60e66ea80044c94ccc1ccc19cc1d0dd5182c183a9baa305830753754008266e2000400c4cdc48008019bad3077307437540022940c154c1ccdd5182b18399baa0023048307137540d86eb4c120c1c4dd500e8a999837a99983799b8f375c60a860e26ea80740fc54ccc1bccdc79bae30573071375403a6eb8c150c1c4dd501d8a99983799b8f375c609260e26ea8074dd7182498389baa03b1533306f3370e6eb4c190c1c4dd500e9bad3064307137540762a6660de66e1cdd6982698389baa01d375a609a60e26ea80ec54ccc1bccdd7982718389baa01d304e307137540762a6660de66e1cdd6982418389baa01d375a609060e26ea80ec54ccc1bccdc39bad304f3071375403a6eb4c140c1c4dd501d8a99983799b8f375c60e860ea60ea60ea60ea60ea60ea60ea60ea60ea60ea60ea60e26ea8074dd7182b98389baa03b13370e6eb4c158c1c4dd500e99b80375a60ac60e26ea80ed200114a029405280a5014a029405280a5014a02a6660de66e24c16cdd6182818389baa01d375a609e60e26ea807454ccc1bcc8cc004004dd6182898391baa01e22533307400114a2264a6660e464a6660e660ac6eb8c15cc1d4dd50008a999839982b1bae305b307537540022660b26eb0c168c1d4dd50381bae305b307537540022940528183b8010998018018008a5030770011533306f533306f3068375a609a60e26ea80745288a99983798341bad30643071375403a294454ccc1bcccc1bcc1a0cdc3182e9bad30563071375403a6eb4c134c1c4dd500ea504a229444c8cc004004dd6182798391baa01e22533307400114a2264a6660e464660a008c4a6660e866ebcc164c1d8dd50009ba6325333075306e00114bd6f7b6300991919800800a5eb7bdb180894ccc1ec0044cc1f0cdd82601014000374c00697adef6c60132323232533307c3372091010000213308001337609801014000374c00e00a2a6660f866e3d2210000213308001337609801014000374c00e0062661000266ec0dd48011ba600133006006003375660fa0066eb8c1ec008c1fc008c1f4004c8cc0040052f5bded8c044a6660f40022660f666ec13001014000375000697adef6c60132323232533307b3372091010000213307f337609801014000375000e00a2a6660f666e3d2210000213307f337609801014000375000e0062660fe66ec0dd48011ba800133006006003375a60f80066eb8c1e8008c1f8008c1f0004cdc19bad30693076375404460ba6eb0c14cc1d8dd5011099baf30583076375460b060ec6ea8004c1accc1e0dd480125eb805281bae307700213300300300114a060ee0022646609a08e464646466e3cdc919b8a0023337929412004001005375a60f060f20046eb8c1dc004c1ccdd5182a98399baa001375c60a660e26ea80745280a5014a029405280a5014a029404c94ccc1c0c1a4c1c4dd500089919191919191919299983d983f00109982d00091299983e8010980618400080689918011840808019b99375c60fe0042c6eb0c1f0004c1f0008dd7183d000983d0011b99375c60f000260f00046eb8c1d8004c1c8dd50008b183a0010991801183a0019bae307200216375c60de00260de0046eb4c1b4004c1b4008dd6183580098358011bad30690013069002375a60ce00260ce0046eb0c194004c194008dd6983180098318011bad30610013061002375c60be00260be0046eb8c174004c174008dd7182d800982d8011bae3059001305537540022c60ae60a86ea800458c0e4c14cdd5000982a98291baa00116302b001163303d021233304f3375e606e60a26ea800530103d87980004a094458dd6181898279baa019161613230023054003375c60a4004264600460a40066eb8c14000858dd6982680098268011bad304b001304b002375a609200260920046eb0c11c004c11c008dd6982280098228011bad30430013043002375c608200260820046eb8c0fc004c0fc008dd7181e800981e8011bac303b001303737540022c6072606c6ea800458c06cc0d4dd5180c181a9baa0013037303437540022c601a00c2c6eb8c0d4c0c8dd50008b180d0008b1bac30333034303430343034303430340023758606400260640046eb0c0c0004c0c0008dd6181700098151baa0252302d302e302e302e302e302e302e302e0012302c302d302d302d001222325333029301d302a37540022900009bad302e302b375400264a666052603a60546ea80045300103d87a8000132330010013756605e60586ea8008894ccc0b8004530103d87a8000132323232533302f337220100042a66605e66e3c0200084c098cc0ccdd4000a5eb80530103d87a8000133006006003375a60600066eb8c0b8008c0c8008c0c0004cc07800c00894ccc0a0004530103d87a80001301c33029302a0014bd701119198008008019129998150008a5013253330283004302d00214a2266006006002605a00246050605260526052605260520024604e6050605060506050605060500024604c604e604e604e604e604e604e604e604e604e604e0024604a604c604c604c604c604c604c604c604c604c00244646600200200644660060026004004466e212000371a0024604400246042604400244646600200200644a66604200229404c94ccc07ccdc79bae302400200414a226600600600260480024603e604060406040604060406040604060400022a66603266e1d200100913232533301b301430073300a37586040004466603866ebcc010c078dd5000a60103d87980004a094454ccc06cc03cc0100044c94ccc070c054c074dd5000899b8f00d375c6042603c6ea800458c0180045858dd6180f981018101810181018101810000980f980f980d9baa016162301e301f301f001300100122533301b0011480004c018cc008008c07800494ccc0640045300103d87a80001300d3301a301b0014bd70180080091299980c0008a4000260066600400460360026e01200222323300100100322533301800114bd7009919299980b980280109980d80119802002000899802002000980e001180d0009bad3012002375c60200022c602600264a66601c6004601e6ea800452f5bded8c026eacc04cc040dd5000998019bab3002300f375401400a6e1d200223011301230123012301200122323300100100322533301100114c103d87a800013232323253330123372200e0042a66602466e3c01c0084c024cc058dd3000a5eb80530103d87a8000133006006003375660260066eb8c044008c054008c04c004dd2a40006eb8c034c028dd50011b874800058c02cc030008c028004c028008c020004c010dd50008a4c26cacae6955ceaab9e5573eae815d0aba21";
    }

    public static String getMintStateTokenHash(CardanoNetwork network) {
        if (network.equals(CardanoNetwork.MAINNET)) {
            return "1919c122cba719a9bf760e4e463bbcf8a3d46327569cdb5edd8b7d0e";
        }
        return "6b3a786359bfb307baa3be8cc4fa9872c219c42b76226a4f97d90a62";
    }

    public static String getUpdateStateTokenCode(CardanoNetwork network) {
        if (network.equals(CardanoNetwork.MAINNET)) {
            return "590b3a01010032323232323232253330023232323232533233008300130093754004264646646464646464646464646464646464646464646464646464646446464a66604e600e60506ea80044c8c94ccc0a4cdc3a400860546ea80044c8cc02400454ccc0a8c08cc060dd6181018161baa0271533302a3375e60106eb0c080c0b0dd5013980919817180f98161baa0014bd700a99981518119998039bab301f302c3754603e60586ea800d2211c1919c122cba719a9bf760e4e463bbcf8a3d46327569cdb5edd8b7d0e00375c603e60586ea80044c8c94ccc0b0c0940044c8c94ccc0b8c038c0bcdd50008992999817981418088028992999818180818189baa00113253330313375e604860666ea8004c090c0ccdd5181318199baa00313253330323370e900218199baa0011323301200115333033302c33301037566050606a6ea800d22011c1919c122cba719a9bf760e4e463bbcf8a3d46327569cdb5edd8b7d0e00375c6050606a6ea80284c8c94ccc0d4c94ccc0d8cdc4240006eb4c0b0c0e0dd500689919299981c1818981c9baa00113253330393032303a3754605c60766ea8c0b8c0ecdd5002099b880010031337120020066eb4c0f4c0e8dd50008a50302a30393754605860726ea8008dd6980d181c1baa00d14a06032606e6ea80c854ccc0d400854ccc0d400454ccc0d4cdc4980b9bac301a303737540066eb4c06cc0dcdd5001899198008009bac301b3038375400844a66607400229444c94ccc0e0c94ccc0e4c0acdd71816181d9baa00115333039302b375c605a60766ea80044c8c8cc004004dd61818981e9baa03822533303f00114a0264a66607a66e3cdd718210010020a511330030030013042001375c605a60766ea80045280a50303d00213300300300114a0607a00229405280a5014a0a66606860286eb4c07cc0d8dd50010a51153330343014375a603c606c6ea80085288a99981a19981a180a19b863024375a6054606c6ea8008dd6980f981b1baa0024a0944528899198008009bac30213037375400644a66607200229444c94ccc0dcc8c8cc004004034894ccc0f4004528099299981d99299981e19baf3031303e37540026e98c94ccc0f4c07400452f5bded8c0264646600200297adef6c60225333043001133044337609801014000374c00697adef6c60132323232533304433720910100002133048337609801014000374c00e00a2a66608866e3d22100002133048337609801014000374c00e00626609066ec0dd48011ba6001330060060033756608a0066eb8c10c008c11c008c114004c8cc0040052f5bded8c044a66608400226608666ec13001014000375000697adef6c60132323232533304333720910100002133047337609801014000375000e00a2a66608666e3d22100002133047337609801014000375000e00626608e66ec0dd48011ba800133006006003375a60880066eb8c108008c118008c110004cdc19bad3026303e375401460546eb0c0a0c0f8dd5005099baf302f303e3754605e607c6ea8004c090cc100dd4802a5eb8052818200010a511330030030013040001375c60780042660060060022940c0f00054ccc0cccdc79bae3026303537540026eb8c098c0d4dd50050a99981999b8f375c6050606a6ea8004dd71814181a9baa00a153330333371e6eb8c09cc0d4dd50009bae3027303537540142a66606666e3cdd7180e181a9baa001375c6038606a6ea802854ccc0cccdc39bad301d303537540026eb4c074c0d4dd50050a99981999b87375a603c606a6ea8004dd6980f181a9baa00a153330333375e603e606a6ea8004c07cc0d4dd50050a99981999b87375a602e606a6ea8004dd6980b981a9baa00a153330333370e6eb4c064c0d4dd50009bad3019303537540142a66606666e3cdd71810181a9baa001375c6040606a6ea80284cdc39bad30293035375400266e00dd69814981a9baa00a480045280a5014a029405280a5014a029405280a50163037303437540022c604a60666ea800458c0d4c0c8dd50008b29998190028a60103d87a8000130173303330340054bd700b181998181baa001163300e37586040605e6ea80a8024dd618189819181918171baa0291533302c300c0011533302c300c300e0021533302c3025301a37586044605c6ea80a44c94ccc0b4c034c0b8dd500089919192999819981b001099299981899b87375a606600490008a99981899b8f00100413371e6eb8c098c0ccdd50040020a5014a06eb8c0c400458c0d0004c94ccc0bcc0a0c0c0dd50008a5eb7bdb1804dd5981a18189baa001330153756603060606ea80ad22011c1919c122cba719a9bf760e4e463bbcf8a3d46327569cdb5edd8b7d0e00375c6064605e6ea800458c028dd6181118171baa0291614a02c646600200200e44a6660600022900009991299981798141998061bab30243031375400491011c1919c122cba719a9bf760e4e463bbcf8a3d46327569cdb5edd8b7d0e00375c604860626ea80184c07c0044004c0c8004cc008008c0cc004c8cc004004018894ccc0bc00452f5c026464a66605c66605c66ebcc088c0c0dd500126103d87980004a09444cc0c8008cc0100100044cc010010004c0cc008c0c4004585858c0b8c0acdd50008b180e18151baa301d302a3754002605860526ea800458cc01cdd6180c98141baa0230023758605460566056604e6ea8088888c94ccc09cc080c0a0dd50008a400026eb4c0b0c0a4dd5000992999813981018141baa00114c103d87a8000132330010013756605a60546ea8008894ccc0b0004530103d87a8000132323232533302d337220100042a66605a66e3c0200084c054cc0c4dd4000a5eb80530103d87a8000133006006003375a605c0066eb8c0b0008c0c0008c0b8004cc03400c00894ccc098004530103d87a80001300b3302730280014bd70112999811980198121baa0021323232323232323232323232323232323232323232323232533303e304100213302c00b22533304000213302e0072253330420021501d132533304030203041375400226464646464646464a666096609c00426607200244a66609a0042601860a001a264600460a20066e64dd718278010b1bac304c001304c002375c609400260940046e64dd7182400098240011bae3046001304237540022c6088004264600460880066eb8c10800858dd7181f800981f8011bad303d001303d0023758607600260760046eb4c0e4004c0e4008dd6981b800981b8011bac30350013035002375a606600260660046eb4c0c4004c0c4008dd7181780098178011bae302d001302d002375c605600260560046eb8c0a4004c094dd50010b1b874800088c8cc00400400c894ccc098004530103d87a80001323253330253375e6030604e6ea80080144c034cc0a40092f5c026600800800260540046050002600200244a6660440022900009807998010011812800918111811981198119811981198119811800918109811181118111811181118111811181118110009181018109810981098109810981098109810981098108009119198008008019129998100008a6103d87a800013232323253330213372200e0042a66604266e3c01c0084c024cc094dd3000a5eb80530103d87a8000133006006003375660440066eb8c080008c090008c088004dd2a40004603a603c603c603c00246038603a603a603a603a0024603660386038603860386038002460346036603660366036603660360024603260346034603460346034603460346034603460346034002600200244a66602c002290000980199801001180c8009b804800888c8cc00400400c88cc00c004c0080088cdc4240006e340048c04c0048c048c04cc04c0048c044c0480048c040c044c044c044c044c044c044c044c044004c03c008c038c03c004c028dd50011b874800858c02cc030008c028004c028008c020004c010dd50008a4c26cacae6955ceaab9e5573eae815d0aba21";
        }
        return "590b3a01010032323232323232253330023232323232533233008300130093754004264646646464646464646464646464646464646464646464646464646446464a66604e600e60506ea80044c8c94ccc0a4cdc3a400860546ea80044c8cc02400454ccc0a8c08cc060dd6181018161baa0271533302a3375e60106eb0c080c0b0dd5013980919817180f98161baa0014bd700a99981518119998039bab301f302c3754603e60586ea800d2211c6b3a786359bfb307baa3be8cc4fa9872c219c42b76226a4f97d90a6200375c603e60586ea80044c8c94ccc0b0c0940044c8c94ccc0b8c038c0bcdd50008992999817981418088028992999818180818189baa00113253330313375e604860666ea8004c090c0ccdd5181318199baa00313253330323370e900218199baa0011323301200115333033302c33301037566050606a6ea800d22011c6b3a786359bfb307baa3be8cc4fa9872c219c42b76226a4f97d90a6200375c6050606a6ea80284c8c94ccc0d4c94ccc0d8cdc4240006eb4c0b0c0e0dd500689919299981c1818981c9baa00113253330393032303a3754605c60766ea8c0b8c0ecdd5002099b880010031337120020066eb4c0f4c0e8dd50008a50302a30393754605860726ea8008dd6980d181c1baa00d14a06032606e6ea80c854ccc0d400854ccc0d400454ccc0d4cdc4980b9bac301a303737540066eb4c06cc0dcdd5001899198008009bac301b3038375400844a66607400229444c94ccc0e0c94ccc0e4c0acdd71816181d9baa00115333039302b375c605a60766ea80044c8c8cc004004dd61818981e9baa03822533303f00114a0264a66607a66e3cdd718210010020a511330030030013042001375c605a60766ea80045280a50303d00213300300300114a0607a00229405280a5014a0a66606860286eb4c07cc0d8dd50010a51153330343014375a603c606c6ea80085288a99981a19981a180a19b863024375a6054606c6ea8008dd6980f981b1baa0024a0944528899198008009bac30213037375400644a66607200229444c94ccc0dcc8c8cc004004034894ccc0f4004528099299981d99299981e19baf3031303e37540026e98c94ccc0f4c07400452f5bded8c0264646600200297adef6c60225333043001133044337609801014000374c00697adef6c60132323232533304433720910100002133048337609801014000374c00e00a2a66608866e3d22100002133048337609801014000374c00e00626609066ec0dd48011ba6001330060060033756608a0066eb8c10c008c11c008c114004c8cc0040052f5bded8c044a66608400226608666ec13001014000375000697adef6c60132323232533304333720910100002133047337609801014000375000e00a2a66608666e3d22100002133047337609801014000375000e00626608e66ec0dd48011ba800133006006003375a60880066eb8c108008c118008c110004cdc19bad3026303e375401460546eb0c0a0c0f8dd5005099baf302f303e3754605e607c6ea8004c090cc100dd4802a5eb8052818200010a511330030030013040001375c60780042660060060022940c0f00054ccc0cccdc79bae3026303537540026eb8c098c0d4dd50050a99981999b8f375c6050606a6ea8004dd71814181a9baa00a153330333371e6eb8c09cc0d4dd50009bae3027303537540142a66606666e3cdd7180e181a9baa001375c6038606a6ea802854ccc0cccdc39bad301d303537540026eb4c074c0d4dd50050a99981999b87375a603c606a6ea8004dd6980f181a9baa00a153330333375e603e606a6ea8004c07cc0d4dd50050a99981999b87375a602e606a6ea8004dd6980b981a9baa00a153330333370e6eb4c064c0d4dd50009bad3019303537540142a66606666e3cdd71810181a9baa001375c6040606a6ea80284cdc39bad30293035375400266e00dd69814981a9baa00a480045280a5014a029405280a5014a029405280a50163037303437540022c604a60666ea800458c0d4c0c8dd50008b29998190028a60103d87a8000130173303330340054bd700b181998181baa001163300e37586040605e6ea80a8024dd618189819181918171baa0291533302c300c0011533302c300c300e0021533302c3025301a37586044605c6ea80a44c94ccc0b4c034c0b8dd500089919192999819981b001099299981899b87375a606600490008a99981899b8f00100413371e6eb8c098c0ccdd50040020a5014a06eb8c0c400458c0d0004c94ccc0bcc0a0c0c0dd50008a5eb7bdb1804dd5981a18189baa001330153756603060606ea80ad22011c6b3a786359bfb307baa3be8cc4fa9872c219c42b76226a4f97d90a6200375c6064605e6ea800458c028dd6181118171baa0291614a02c646600200200e44a6660600022900009991299981798141998061bab30243031375400491011c6b3a786359bfb307baa3be8cc4fa9872c219c42b76226a4f97d90a6200375c604860626ea80184c07c0044004c0c8004cc008008c0cc004c8cc004004018894ccc0bc00452f5c026464a66605c66605c66ebcc088c0c0dd500126103d87980004a09444cc0c8008cc0100100044cc010010004c0cc008c0c4004585858c0b8c0acdd50008b180e18151baa301d302a3754002605860526ea800458cc01cdd6180c98141baa0230023758605460566056604e6ea8088888c94ccc09cc080c0a0dd50008a400026eb4c0b0c0a4dd5000992999813981018141baa00114c103d87a8000132330010013756605a60546ea8008894ccc0b0004530103d87a8000132323232533302d337220100042a66605a66e3c0200084c054cc0c4dd4000a5eb80530103d87a8000133006006003375a605c0066eb8c0b0008c0c0008c0b8004cc03400c00894ccc098004530103d87a80001300b3302730280014bd70112999811980198121baa0021323232323232323232323232323232323232323232323232533303e304100213302c00b22533304000213302e0072253330420021501d132533304030203041375400226464646464646464a666096609c00426607200244a66609a0042601860a001a264600460a20066e64dd718278010b1bac304c001304c002375c609400260940046e64dd7182400098240011bae3046001304237540022c6088004264600460880066eb8c10800858dd7181f800981f8011bad303d001303d0023758607600260760046eb4c0e4004c0e4008dd6981b800981b8011bac30350013035002375a606600260660046eb4c0c4004c0c4008dd7181780098178011bae302d001302d002375c605600260560046eb8c0a4004c094dd50010b1b874800088c8cc00400400c894ccc098004530103d87a80001323253330253375e6030604e6ea80080144c034cc0a40092f5c026600800800260540046050002600200244a6660440022900009807998010011812800918111811981198119811981198119811800918109811181118111811181118111811181118110009181018109810981098109810981098109810981098108009119198008008019129998100008a6103d87a800013232323253330213372200e0042a66604266e3c01c0084c024cc094dd3000a5eb80530103d87a8000133006006003375660440066eb8c080008c090008c088004dd2a40004603a603c603c603c00246038603a603a603a603a0024603660386038603860386038002460346036603660366036603660360024603260346034603460346034603460346034603460346034002600200244a66602c002290000980199801001180c8009b804800888c8cc00400400c88cc00c004c0080088cdc4240006e340048c04c0048c048c04cc04c0048c044c0480048c040c044c044c044c044c044c044c044c044004c03c008c038c03c004c028dd50011b874800858c02cc030008c028004c028008c020004c010dd50008a4c26cacae6955ceaab9e5573eae815d0aba21";
    }

    public static String getUpdateStateTokenHash(CardanoNetwork network) {
        if (network.equals(CardanoNetwork.MAINNET)) {
            return "314cdf9ea60ee354ff1b87da74f15dedd4070604b2819a1d6bac3453";
        }
        return "f2f25cfcc4e1665bad2477fc1aa6e9960ae59ef1681eae28a0bfed16";
    }

    public static Optional<Utxo> getUtxoByTransactionAndUnit(String transactionHash, String unit, BackendService backendService) {
        Result<TxContentUtxo> transactionUtxos;
        try {
            transactionUtxos = backendService.getTransactionService().getTransactionUtxos(transactionHash);
        } catch (ApiException e) {
            log.error("Error getting transaction utxos: {}", e.getMessage());
            return Optional.empty();
        }

        if (transactionUtxos.isSuccessful()) {
            for (TxContentUtxoOutputs output : transactionUtxos.getValue().getOutputs()) {
                Optional<TxContentOutputAmount> outputWithUnit = output.getAmount().stream().filter(amount -> amount.getUnit().equals(unit)).findFirst();
                if (outputWithUnit.isPresent()) {
                    return Optional.of(output.toUtxos(transactionHash));
                }
            }
        } else {
            log.error("Error getting transaction utxos: {}", transactionUtxos.getResponse());
        }

        return Optional.empty();
    }

    public static String extractStringFromPlutusData(PlutusData plutusData) {
        return new String(((BytesPlutusData) plutusData).getValue());
    }

    public static String extractByteArrayFromPlutusData(PlutusData plutusData) {
        return HexUtil.encodeHexString(((BytesPlutusData) plutusData).getValue());
    }

    public static List<byte[]> extractListFromPlutusData(PlutusData plutusData) {
        return ((ListPlutusData) plutusData).getPlutusDataList().stream()
                .map(item -> ((BytesPlutusData) item).getValue())
                .collect(Collectors.toList());
    }

    public static Integer extractIntegerFromPlutusData(PlutusData plutusData) {
        return ((BigIntPlutusData) plutusData).getValue().intValue();
    }

    public static Boolean extractBooleanFromPlutusData(PlutusData plutusData) {
        return ((ConstrPlutusData) plutusData).getAlternative() == 1;
    }

    public static Long extractLongFromPlutusData(PlutusData plutusData) {
        return ((BigIntPlutusData) plutusData).getValue().longValue();
    }

    public static boolean includesStateToken(TransactionOutput output) {
        return output.getValue().getMultiAssets().stream().anyMatch(
                asset -> asset.getPolicyId() != null && asset.getPolicyId().equalsIgnoreCase(getMintStateTokenHash(CardanoNetwork.MAINNET))
                        || asset.getPolicyId().equalsIgnoreCase(getMintStateTokenHash(CardanoNetwork.PREPROD))
        );
    }

    public static boolean includesStateToken(AddressUtxo addressUtxo, CardanoNetwork network) {
        return addressUtxo.getAmounts().stream()
                .anyMatch(asset -> asset.getPolicyId() != null && asset.getPolicyId().equals(ValidatorUtils.getMintStateTokenHash(network)));

    }

    public static boolean includesBootstrapToken(AddressUtxo addressUtxo, CardanoNetwork network) {
        return addressUtxo.getAmounts().stream()
                .anyMatch(asset -> asset.getPolicyId() != null && asset.getPolicyId().equals(ValidatorUtils.getMintOrBurnAuthTokenHash(network)));
    }

    public static boolean isMintingTransaction(AddressUtxo addressUtxo, String policyId) {
        return addressUtxo.getAmounts().stream()
                .anyMatch(input -> input.getPolicyId() != null && input.getPolicyId().equals(policyId) &&
                        input.getQuantity().equals(BigInteger.ONE));
    }

    public static boolean isBurningTransaction(AddressUtxo addressUtxo, String policyId) {
        return addressUtxo.getAmounts().stream()
                .anyMatch(input -> input.getPolicyId() != null && input.getPolicyId().equals(policyId) &&
                        input.getQuantity().equals(BigInteger.valueOf(-1)));
    }

    public static String getBootstrapTokenName(AddressUtxo addressUtxo, CardanoNetwork network) {
        return addressUtxo.getAmounts().stream()
                .filter(input -> input.getPolicyId() != null && input.getPolicyId().equals(getMintOrBurnAuthTokenHash(network)))
                .findFirst()
                .map(Amt::getAssetName)
                .orElseThrow(() -> new IllegalArgumentException("Bootstrap token not found"));
    }
}
