/*
 * UVerify Backend
 * Copyright (C) 2025 Fabian Bormann
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program. If not, see <http://www.gnu.org/licenses/>.
 */

package io.uverify.backend.util;

import com.bloxbean.cardano.client.api.exception.ApiException;
import com.bloxbean.cardano.client.api.model.Result;
import com.bloxbean.cardano.client.api.model.Utxo;
import com.bloxbean.cardano.client.backend.api.BackendService;
import com.bloxbean.cardano.client.backend.model.TxContentOutputAmount;
import com.bloxbean.cardano.client.backend.model.TxContentUtxo;
import com.bloxbean.cardano.client.backend.model.TxContentUtxoOutputs;
import com.bloxbean.cardano.client.plutus.blueprint.PlutusBlueprintUtil;
import com.bloxbean.cardano.client.plutus.blueprint.model.PlutusVersion;
import com.bloxbean.cardano.client.plutus.spec.*;
import com.bloxbean.cardano.client.transaction.spec.TransactionOutput;
import com.bloxbean.cardano.client.util.HexUtil;
import com.bloxbean.cardano.yaci.store.common.domain.AddressUtxo;
import com.bloxbean.cardano.yaci.store.common.domain.Amt;
import io.uverify.backend.enums.CardanoNetwork;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.codec.binary.Hex;
import org.apache.commons.codec.digest.DigestUtils;
import scalus.bloxbean.ScalusScriptUtils;

import java.math.BigInteger;
import java.nio.charset.StandardCharsets;
import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

@Slf4j
public class ValidatorUtils {
    public static String getProxyStateTokenName(String txHash, int outputIndex) {
        // Convert hex string to bytes
        byte[] txHashBytes;
        try {
            txHashBytes = Hex.decodeHex(txHash.toCharArray());
        } catch (java.lang.Exception exception) {
            log.error(exception.getMessage());
            return "";
        }
        // Convert outputIndex to string and then to bytes
        String outputIndexString = String.valueOf(outputIndex);
        byte[] outputIndexBytes = outputIndexString.getBytes(StandardCharsets.UTF_8);

        // Combine both byte arrays
        byte[] messageBuffer = new byte[txHashBytes.length + outputIndexBytes.length];
        System.arraycopy(txHashBytes, 0, messageBuffer, 0, txHashBytes.length);
        System.arraycopy(outputIndexBytes, 0, messageBuffer, txHashBytes.length, outputIndexBytes.length);

        // Calculate SHA3-256 hash and return as hex string
        return DigestUtils.sha3_256Hex(messageBuffer);
    }

    public static String getMintOrBurnAuthTokenCode(CardanoNetwork network) {
        if (network.equals(CardanoNetwork.MAINNET)) {
            return "5901f801010032323232323232253330023232323232323232323253233300d3370e900000309919192999809980b0010992999808a99980898028008a5113370e00290008a999808980298041bac30073013375401c26600c6eb0c01cc04cdd500724411c81c0d7f845fb2cf5d23453dc63997595688973c860786503c4d47b11001616375a60240022c602800264a66601e600660206ea800452f5bded8c026eacc050c044dd500099198008009bab301430153015301530153011375401844a6660260022980103d87a800013232323253330143372200e0042a66602866e3c01c0084cdd2a4000660306e980052f5c02980103d87a80001330060060033756602a0066eb8c04c008c05c008c054004dd7180918079baa0071533300d300100613232325333010300430073758600c60246ea80344cc014dd6180318091baa00d48811c81c0d7f845fb2cf5d23453dc63997595688973c860786503c4d47b110016301430150023013001300f375400e2c6e1d200222323300100100322533301200114a0264a66602066e3cdd7180a8010020a5113300300300130150012301030113011301130113011301130113011001300100122533300d0011480004cdc02400466004004602000260106ea8004c02cc030008c028004c028008c020004c010dd50008a4c26cacae6955ceaab9e5573eae815d0aba201";
        }
        return "5901f801010032323232323232253330023232323232323232323253233300d3370e900000309919192999809980b0010992999808a99980898028008a5113370e00290008a999808980298041bac30073013375401c26600c6eb0c01cc04cdd500724411c11bcb8e4a79304e23bcd5e2bf628907f9b998f43902f41d1db439981001616375a60240022c602800264a66601e600660206ea800452f5bded8c026eacc050c044dd500099198008009bab301430153015301530153011375401844a6660260022980103d87a800013232323253330143372200e0042a66602866e3c01c0084cdd2a4000660306e980052f5c02980103d87a80001330060060033756602a0066eb8c04c008c05c008c054004dd7180918079baa0071533300d300100613232325333010300430073758600c60246ea80344cc014dd6180318091baa00d48811c11bcb8e4a79304e23bcd5e2bf628907f9b998f43902f41d1db4399810016301430150023013001300f375400e2c6e1d200222323300100100322533301200114a0264a66602066e3cdd7180a8010020a5113300300300130150012301030113011301130113011301130113011001300100122533300d0011480004cdc02400466004004602000260106ea8004c02cc030008c028004c028008c020004c010dd50008a4c26cacae6955ceaab9e5573eae815d0aba201";
    }

    public static String validatorToScriptHash(PlutusScript script) {
        try {
            return HexUtil.encodeHexString(script.getScriptHash());
        } catch (Exception e) {
            log.error("Error computing policy id: " + e.getMessage());
            return null;
        }
    }

    public static PlutusScript getUVerifyStateContract() {
        String compiledCode = "59150d0101002229800aba2aba1aba0aab9faab9eaab9dab9a9bae0039bae002488888888966002646465300130073754003370e90024dc3a4001300b0039805801244444b30013004005899912cc004c014c038dd5001c4c8cc8966002602c0031330043758602a00244b30010028cc004c050dd5004c88c8cc00400400c896600200314bd7044cc8966002600a00513301c00233004004001899802002000a030301b001301c00140652301830190019b804800a6e1d200291191919800800802112cc00400600713233225980099b910070028acc004cdc78038014400600c80d226600a00a604000880d0dd7180c8009bab301a001301c0014068297adef6c609180c180c980c980c980c980c980c980c980c980c980c800c8c060c064c064c0640064603060326032003230183019301930193019301930190019180c180c980c980c980c800c88c8cc00400400c896600200314a11598009801980d800c528c4cc008008c07000501620329ba5480024603060326032603260326032603260320032232330010010032259800800c528456600266e3cdd7180d800801c528c4cc008008c07000501620329b8848002460306032603260326032603200323018301930193019301930193019301930190019180c180c980c980c980c980c980c980c980c980c800a44444444444444444453001302b0139bac302a013912cc0040062900044c048cc008008c0b400502a488c8c966002602600313259800980a18159baa3016302c3754602c60586ea8016266e20004012266e2400401102a1bad302e302b37540051598009811000c5284528a05240a460526ea8004c0b0c0a4dd5180998149baa002912cc0040062900044c048cc008008c0b400502a488cc01c0080064600a6e3400644b3001301f30283754005132323232323232323232329800992cc004c0d40062b3001337129002181a000c5a2603a6068002819a2c81b0dd5181b800cdd7181b805cdd7181b8054dd6981b804cdd6981b8044dd6981b8034dd6981b802cdd7181b8024dd6981b801cdd7181b80124444444444b3001304200b8998181bac3041011225980080140622646004608a0066eb8c10c00904145903f0c0dc004c0d8004c0d4004c0d0004c0cc004c0c8004c0c4004c0c0004c0bc004c0b8004c0a4dd5001459027496600200314c0103d87a800089804198151815800a5eb810294888c8cc88cc008008004896600200300389919912cc004cdc8803801456600266e3c01c00a200300640b9133005005303400440b86eb8c0b4004dd698170009818000a05c3301200400314800122222222229800981a8054dd6181a0054cc0700248cdd7981a98191baa303530323754603860646ea8004cdd2a4004660686ea40bd2f5c130080089803003488966002646600200200644b30010018a518acc004c96600260146eb8c0e8c0dcdd5000c56600260146eb8c06cc0dcdd5000c4cc02c010dd7180d981b9baa0018a5040d514a081a8c0e4006266004004607400314a081a103744cdc78019b92329800800c00e911004004444b30010028800c66002007303b00299b8a0013232323371466e28cdc51bae303d00337306e64dd7181e8011bae303d001329800800cdd6181f181f80152201004004444b30010028800c66002007304100299b8a00137306e64dd71820001200640f8607a0026078002606e6ea8c0e800900320708a5040c89111114c004c0ecc0ec01a6eb0c0e801a64b3001302e0018a508acc004c08000629462c81b1036180180248966002605e6eb4c078c0e4dd5000c528c566002605e6eb4c074c0e4dd5000c528c5660033001302f3370c60446eb4c070c0e4dd50009bad301e303937540034a14a281ba2946264660020026eb0c070c0e8dd5001112cc00400629462b3001323301d00525980099baf3027303d37540026e98c966002606800314bd6f7b63044c8c8cc0040052f5bded8c044b300100189982199bb04c01014000374c00697adef6c608994c004dd71820800cdd59821000cc1180092225980099b904890000389982399bb04c01014000374c00e00b15980099b8f4890000389982399bb04c01014000374c00e003133047337606ea400cdd300119803003000a086410c30440014108646600200297adef6c602259800800c4cc108cdd8261014000375000697adef6c608994c004dd71820000cdd69820800cc1140092225980099b904890000389982319bb04c01014000375000e00b15980099b8f4890000389982319bb04c01014000375000e003133046337606ea400cdd400119803003000a08441083043001410481e0cdc19bad3021303d375400a60106eb0c07cc0f4dd5002c4cdd79820181e9baa3040303d3754002603a6607e6ea40092f5c114a081d8dd7181f000c4cc008008c0fc0062941039207840dc81b903724444653001303f0019bac303f3040001cc00566002660466eacc0fc0140e62946294103d528528a074488966002b30010018cc004cc098dd59810981f9baa03403c91118154c00400e0050014049223233001001330290030022259800800c52844c8c96600266008008609200714a31302d375a608a0048218dd718218009823000a088918101982119ba548008cc108dd4800a5eb80cc10930103d87a80004bd704dd71821181f9baa03392cc00400629462941041496600200314c0103d87a800089810198211821800a5eb810412444444464b30013371e91010e6d696e745f626f6f747374726170000048992cc004c0f8c11cdd5000c4c966002608060906ea8006264b30013040304937540031323232323232323298009bad30550019bae30550079bad30550069bad30550059bac30550049bad30550039bad3055002488888896600260ba01113304b375860b801e44b3001002899826802912cc00400a264b30013054305d375400315980098231919800800810112cc0040062900044c124cc008008c190005061456600266e3c02cdd71830982f1baa0018acc004cdc42400400d159800981d806456600260346eb0c120c178dd50294566002608c60540311330320214891c11bcb8e4a79304e23bcd5e2bf628907f9b998f43902f41d1db439981008a50417114a082e2294105c452820b88a50417114a082e22c82e0c060c8cc00400407c896600200314bd7044cc184c178c188004cc008008c18c00506044c8c008c18800cdd7183000120bc899180118300019bae305e0024171164168305500130540013053001305200130510013050001304f001304a3754003164120609860926ea80062c8238c12cc130c130c120dd5182598241baa0018b208c3018001899912cc004cdc7a450a6d696e745f7374617465000068992cc004c100c124dd5000c4c966002608460946ea80062646603c00226464b30013044304d37540031323259800982398279baa00189919804800899192cc004c124c148dd5000c4c9660026078603e007159800acc004c128c07c006294626078603e00282922b30013371e6eb8c15cc150dd50011bae305730543754013159800991981b01691919b8f372466e28dd7182d000cc00528520049bad305a305b0015e4800cc158dd5182c982b1baa001375c60ae60a86ea80262b3001980098081bac303e305437540914a14a282922b300198009bae3033305437540133758607c60a86ea812202e80f22b3001303c98009bab303e30543754607c60a86ea801a0a3375c607c60a86ea80110244566002b3001598009bac30573054375400914a314a082aa29462660646eb0c15cc150dd50021bae303e3054375401282922b30015980099b8f375c607c60a86ea8024dd7181f182a1baa0098acc004cdc39bad3038305437540126eb4c0e0c150dd5002456600266e1cdd6981c982a1baa009375a607260a86ea80122b30013375e606c60a86ea8024c0d8c150dd5002456600266e1cdd69818182a1baa009375a606060a86ea80122b30013370e6eb4c0bcc150dd50049bad30333054375400915980099b8f375c605c60a86ea8024dd7181f182a1baa004899b87375a606e60a86ea8024cdc01bad3037305437540089000c52820a48a50414914a082922941052452820a48a50414914a082922b3001303c302000e8acc004c0f0c0800222b30013301a01c0098acc004cc0a8c0ccc150dd50249bad3030305437540131598009981400b9bae303e3054375401313371260406eb0c0f8c150dd50241bad302f3054375401314a082922941052452820a48a50414914a082922941052452820a48a50414914a082922941052452820a48a50414914a0829229410521980600a24003164144601a002660140249001182998281baa0018b209c3033304f37546072609e6ea8004c144c138dd5000c5904c180f0009981b80d12cc004cdd7982818269baa3037304d37540026016095159800998061bab3037304d3754606e609a6ea800412a3300198009bab3037304d3754606e609a6ea800609504940354a14a2825a294104b45282096304e304b3754003164124609a609c609c60946ea8c134c128dd5000c59048180d001c4c96600266e3d22010e6275726e5f626f6f7473747261700000789919912cc004c10cc130dd500144c8c966002608a609c6ea8006264b30013047304f37540031323300900115980098069bac303b3051375408b1598009823980e002c5660026072603800f15980099b8f375c607660a26ea80040122b3001300d00b89981280a2451c11bcb8e4a79304e23bcd5e2bf628907f9b998f43902f41d1db439981008a50413d14a0827a294104f4528209e8a50413c60a660a06ea80062c8270c0ccc13cdd5181c98279baa3052304f37540031641346600a04c4606f300137566072609e6ea8c0e4c13cdd5000c13200480f8dd7182818269baa0028b209630060013300400c48008cc00c02d20018acc004cdc7a450a6275726e5f73746174650000789919912cc004c10cc130dd500144c8c966002608a609c6ea8006264b30013047304f3754003132330230011598009981280a1bae303b3051375400315980099b8f004375c60a860a26ea80062b30019800981c98281baa3037305137540034a14a2827a2b3001300d3758607660a26ea81162b30013047301c0058acc004c0e4c07001e2601a01714a0827a294104f4528209e8a50413d14a0827a294104f182998281baa0018b209c3033304f37546072609e6ea8c148c13cdd5000c5904d198028131181bcc004dd5981c98279baa3039304f375400304c801203e375c60a0609a6ea800a2c8258c018004cc01003120023300300b48006294104820902232330010010032259800800c530103d87a80008992cc004c0100062605c660a000297ae08998018019829001209830500014138823888c8cc00400400c896600200314bd7044ca60026eb8c12c0066eb4c13000660a00049112cc004cdc380380144cc144dd480199803003000c4cc01801800504d0c13800504c112cc004c0fcc120dd500144c8c8c8c8c8c8c8ca60026eb4c1500066eb8c15001e6eb4c15001a6eb4c1500166eb0c1500126eb4c15000e6eb4c150009222222259800982e00444cc128dd6182d807912cc00400a26609800a44b300100280a44c8c008c18400cdd7182f80120ba8991801182f8019bae305d002416d16416430540013053001305200130510013050001304f001304e0013049375400516411c8228cc0c403896600266ebcc128c11cdd5000980282245660026600c6eacc0c4c11cdd5000822466003300137566062608e6ea8006089043401d4a14a2822a29410454528208a4528a07a8acc0056600200d13259800981b181f9baa001899192cc004c0e4c104dd5000c4cc896600266e3d2210e6275726e5f626f6f747374726170000018803456600266e3d2210a6275726e5f7374617465000018803456600266e3d2210c7570646174655f73746174650000189980b0010992cc004c0b4c110dd5000c4c8c8c8cc8966002608060926ea800a26464b30013043304b37540031323301f001159800998108081bae3037304d375401715980099baf3050304d375400660a0609a6ea8c0dcc134dd5006c566002606a603200d159800981a8024566002606b30013756606e609a6ea800e011375c60a0609a6ea802d01d4566002606b30013756606e609a6ea8c0dcc134dd5006c0226eb8c140c134dd5005a03a8acc0056600260546eb4c0c0c134dd5005c4cc08c044dd6981498269baa00b8a50412d159800acc0066002606a60986ea8c0ccc134dd5005d28528a0968acc004cdc79bae3050304d37540026eb8c140c134dd5005c56600266e3cdd7181b98269baa001375c606e609a6ea802e2b30013370e6eb4c0c4c134dd50009bad3031304d375401715980099b87375a6064609a6ea8004dd6981918269baa00b8acc004cdd7981798269baa001302f304d375401715980099b87375a6052609a6ea8004dd6981498269baa00b8acc004cdc39bad3028304d37540026eb4c0a0c134dd5005c56600266e3cdd7181398269baa001375c604e609a6ea802e266e1cdd6981818269baa001337006eb4c0c0c134dd5005a400314a0825a294104b452820968a50412d14a0825a294104b452820968a50412d14a0825a2b3001330130150018acc004cdc4980c9bac3037304d37540826eb4c0a0c134dd5000c660026eb8c0b0c134dd5000cdd6181b98269baa041808202e8a50412d14a0825a294104b452820968a50412d14a0825a294104b452820968a50412d14a08258c13cc130dd5000c5904a181798259baa001304d304a37540051641206032002646600200200644b30010018a40011332259800981a4c004dd5981b18261baa002803cdd7182798261baa00a4071130350018800a094304d00133002002304e001412c66064002530013375e605860906ea800530103d8798000a50a5141186606201c464b300130303047375400313371e0066eb8c12cc120dd5000c528208c304a304737546094608e6ea8004dd7182418229baa0018b2086304730443754608e60886ea8c0b8c110dd50024528208441088210c114c108dd50009bae30453042375406d164100604a60826ea8c0acc104dd5000982198201baa0018b207c301000c8a5140f5159800800c528c401903d4528207a8a5040f4303f303f303f00408992cc004c02cc050dd5000c4c8c8ca60026eb8c06c0066038003375c603600737326eb8c06c0092222598009810001c4cc038dd6180f801912cc00400a2601660440191323002302300337326eb8c08400901f45901d0c06c004c068004c054dd5000c59013180b801202a8b2026375c60260026028002601e6ea800e2c8068c040c034dd500311191980080080191198018009801001456600266e1d2006005899192cc004c014c038dd5180918098014528c5900d1bad3011001300d375400d16402c8058601460160026014002600a6ea802a29344d95900301";
        return PlutusBlueprintUtil.getPlutusScriptFromCompiledCode(compiledCode, PlutusVersion.v3);
    }

    public static PlutusScript getUVerifyStateContract(String scriptHash, String proxyTokenName) {
        PlutusScript plainScript = getUVerifyStateContract();

        String parameterizedScript = ScalusScriptUtils.applyParamsToScript(plainScript.getCborHex(),
                BytesPlutusData.of(HexUtil.decodeHexString(scriptHash)),
                BytesPlutusData.of(HexUtil.decodeHexString(proxyTokenName)));
        return PlutusV3Script.builder().cborHex(parameterizedScript).build();
    }

    public static PlutusScript getUVerifyStateContract(String txHash, int outputIndex) {
        PlutusScript proxyContract = getUverifyProxyContract(txHash, outputIndex);
        String proxyScriptHash = validatorToScriptHash(proxyContract);

        if (proxyScriptHash == null) {
            throw new IllegalArgumentException("Script hash of proxy contract is null");
        }

        String proxyTokenName = getProxyStateTokenName(txHash, outputIndex);

        PlutusScript plainScript = getUVerifyStateContract();

        String parameterizedScript = ScalusScriptUtils.applyParamsToScript(plainScript.getCborHex(),
                BytesPlutusData.of(HexUtil.decodeHexString(proxyScriptHash)),
                BytesPlutusData.of(HexUtil.decodeHexString(proxyTokenName)));
        return PlutusV3Script.builder().cborHex(parameterizedScript).build();
    }

    public static PlutusScript getUVerifyProxyContract() {
        String compiledCode = "590a7f010100229800aba4aba2aba1aba0aab9faab9eaab9dab9a488888889660033001300337540132232330010010032259800800c528456600266e3cdd71805000801c528c4cc008008c02c0050052010911919800800801912cc00400629422b30013375e601400200714a3133002002300b0014014804244b30010018a5eb8226600e6008601000266004004601200280326e1d20009180398041804000cdd2a4001374a9001488c8cc00400400c896600200314bd7044cc8966002600a00513300b00233004004001899802002000a00e300a001300b00140212259800800c52f5c1133007300430080013300200230090014019223232330010010042259800800c00e2646644b30013372200e00515980099b8f0070028800c01900944cc014014c03c0110091bae3008001375660120026016002804852f5bded8c12300730080019112cc004cdc48012400110018cc00400e66e10009201499b8b3370066e14009201448180005003200891111919800800802912cc004006200b13259800800c4cc010c03400801a26600a601a004660060060028058c03400500a4dc3a4005370e90022444444444444444530013017010980b008488cc044008006601a01b22598009807180a1baa0028991919912cc004c07400e00b1640686eb8c068004dd7180d001180d000980a9baa0028b202692cc004006298103d87a8000898059980b180b800a5eb8101548c02ccc058c028cc058dd4800a5eb80cc05930103d87a80004bd704c01c01e6008008911111111199119194c0048dcc998011ba80014881009811806cc07cdd50022444b3001301c00189919912cc004c07c0062b30013026375400b0028b204e8acc004c0540062b30013026375400b0028b204e8b2048409026464646465300137566058003372666e28dd7181618149baa030373060126eb4c06cc0a4dd50184dd598160012444b3001301b302b375401715980099198008009bac30300092259800800c528456600266ebcc0c4c0b8dd5181880081ac528c4cc008008c0c800502c205e899192cc004c09cc0b4dd5000c4c966002603a605c6ea8006264b30013029302f37540031323259800981b000c4c8cc8966002605c60686ea800a2b3001302432330010010042259800800c52000899b8048008cc008008c0ec00503845660026048646600200201444b30010018a4001133700900119801001181d800a0708acc004cdc79bae303830353754004017133020375860706072607201a6eb8c0e00122941033452820668a5040cd1640cc64b30010018a6103d87a8000898159981b181b800a5eb81035180c8009bae30360033302500700f8b20663035001303037540031640b86064605e6ea80062c8168c0c4c0c8c0c8c0b8dd5181898171baa0018b20583015001330213758605e00c4b30013375e6060605a6ea8004c05002a26605264660020026eacc080c0b8dd5001112cc004006297ae089981898171819000998010011819800a06000a8a5040ad1640a91332259800981398169baa0018992cc004c074c0b8dd5000c4c8cc06400456600330013302c004006a50a5140b913302b301a00730263303230333030375400297ae08a5040b86064605e6ea80062c8168c098c0b8dd5181018171baa3031302e37540031640b060246603e0020126028660426eb0c0bc01c966002660526026660406eacc07cc0b4dd5180f98169baa00100a003899baf3030302d3754603e605a6ea8004c05002a294102b205418161816000981598158009815000981480098121baa010302337540066eb8c098c08cdd5003c5660026024003132329800899911919194c004dd59816800cdd6181698171817000ccc010dd61816802919baf302e302b375400200e9112cc004c098c0b0dd5000c4c8c966002603c605c6ea800633001375c6064605e6ea80066066605e6ea8c084c0bcdd50014dc999b8a375c6064605e6ea80d8dcc18079bad3021302f375406c91119912cc004c08cc0ccdd5009c4c966002605c60686ea8006264b3001302430353754003132598009818181b1baa001899192cc004c0f400626644b30013029303a375401313259800981a981d9baa001899192cc004c10800626644b30019800806d28528a07c8acc004cc0ac0540062b30013371e00c00314a313302b01500640f914a081f2294103e1bae3041002375c60820031640fc608200260786ea80062c81d0c0f8c0ecdd5004c590391bae303c002375c60780031640e86078002606e6ea80062c81a8c0e4c0d8dd5000c59034181c181c981c981a9baa3038303537540031640cc6601c6eb0c0dc030966002660626036660506eacc09cc0d4dd500080300244cdd7981c181a9baa001301c0068a5040cd132598009817181a1baa0018992cc004c090c0d4dd5000c4c8cc080004566002009133032302100d302d33039303a3037375400297ae08a5040d46072606c6ea80062c81a0c0b4c0d4dd51813981a9baa3038303537540031640cc6038660526eb0c0dc034966002660626036660506eacc09cc0d4dd51813981a9baa001006004899baf303830353754604e606a6ea8004c07001a2941033206430353036002980099817180c198129bab3035002003001a50a5140c08b205a3031302e37546062605c6ea8c080c0b8dd5000981818169baa0018b205618169816981698168009816000981580118129baa0112232330010010032259800800c530103d87a80008992cc004c010006260426605800297ae089980180198170012050302c00140a93024375400930283029002488966002604200515980098141baa007801c590294566002602e00515980098141baa007801c59029459026204c181380098119baa0078b2042408430010012223259800801c4c8c8cc88cc024008cdc524501280059800800c4cdc52441035b5d2900006899b8a489035b5f20009800800ccdc52441025d2900006914c00402a00530070014029229800805400a0028051016204e5980099b880014803a266e0120f2010018acc004cdc4000a41000513370066e01208014001480362c81110221bac3024002375a60440026466ec0dd418110009ba73023001375400713259800800c4cdc52441027b7d00003899b8a489037b5f20003232330010010032259800800c400e264b30010018994c00402a604e003337149101023a200098008054c0a000600a805100a181500144ca6002015302700199b8a489023a200098008054c0a0006600e66008008004805100a18150012050302a001409c66e29220102207d0000340906eac00e264b3001001899b8a489025b5d00003899b8a489035b5f20009800800ccdc52441015d00003914c00401e0053004001401d229800803c00a002803901320483758007133005375a0060051323371491102682700329800800ccdc01b8d0024800666e292210127000044004444b3001337100049000440062646645300100699b800054800666e2ccdc00012cc004cdc40012402914818229037204e3371666e000056600266e2000520148a40c11481b9027002200c33706002901019b8600148080cdc70020012048375c0068138dc5245022c2000301f30200092232330010010032259800980c800c4cdc524410130000038acc004cdc4000a40011337149101012d0033002002337029000000c4cc014cdc2000a402866e2ccdc019b85001480512060003407880f08a4d1365640041";
        return PlutusBlueprintUtil.getPlutusScriptFromCompiledCode(compiledCode, PlutusVersion.v3);
    }

    public static PlutusScript getUverifyProxyContract(Utxo utxo) {
        return getUverifyProxyContract(utxo.getTxHash(), utxo.getOutputIndex());
    }

    public static PlutusScript getUverifyProxyContract(String txHash, int outputIndex) {
        PlutusScript plainScript = getUVerifyProxyContract();

        PlutusData outputReference = ConstrPlutusData.of(0,
                BytesPlutusData.of(HexUtil.decodeHexString(txHash)),
                BigIntPlutusData.of(outputIndex));


        String parameterizedScript = ScalusScriptUtils.applyParamsToScript(plainScript.getCborHex(), outputReference);
        return PlutusV3Script.builder().cborHex(parameterizedScript).build();
    }

    public static String getMintOrBurnAuthTokenHash(CardanoNetwork network) {
        if (network.equals(CardanoNetwork.MAINNET)) {
            return "a8172157733dd50ef6f0f8d38e361745037f0a79c1f5da9b1d8079ff";
        }
        return "d3c25617941168e238038f1cf6542229b919bbd6fd2b8292ce176203";
    }

    public static String getMintStateTokenCode(CardanoNetwork network) {
        if (network.equals(CardanoNetwork.MAINNET)) {
            return "590b9301010032323232323232253330023232323232533233008300130093754004264646464646464a666024602a004264646464646464646464a666032601a012264646464646464646464646464646464646464646464a66605e60466030002264a666060605260626ea80044c94ccc0c4c094c0740184c94ccc0c8c0acc0ccdd500089919299981a19b8748010c0d4dd5000899299981a9817181b1baa00113232323232323232323232323232323232323232533304c304f00213302b01322533304e00213302d0092253330500021533304d304133302837566064609e6ea8c0c8c13cdd500da451ca8172157733dd50ef6f0f8d38e361745037f0a79c1f5da9b1d8079ff00375c606a609e6ea806454ccc134cdd7981898279baa3031304f37546064609e6ea806ccdd2a4004660a298011e581ca8172157733dd50ef6f0f8d38e361745037f0a79c1f5da9b1d8079ff004bd70099299982729998271823981b8008a5113303400101e132533304f3043303b001132533305030493051375400226464a6660a466e1d200430533754002264a6660a6609860a86ea80044c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c94ccc1b8c1c40084cc13402c894ccc1c00084cc13c01c894ccc1c800854ccc1bccdc781f9bae30543071375403a2a6660de60c66660946eacc150c1c4dd500f83381f8a99983799baf30533071375460a660e26ea807ccdd2a4004660e6609260e26ea80752f5c02a6660de664464a6660e460cc60e66ea80044c94ccc1ccc19cc1d0dd5182c183a9baa305830753754008266e2000400c4cdc48008019bad3077307437540022940c154c1ccdd5182b18399baa0023048307137540d86eb4c120c1c4dd500e8a999837a99983799b8f375c60a860e26ea80740fc54ccc1bccdc79bae30573071375403a6eb8c150c1c4dd501d8a99983799b8f375c609260e26ea8074dd7182498389baa03b1533306f3370e6eb4c190c1c4dd500e9bad3064307137540762a6660de66e1cdd6982698389baa01d375a609a60e26ea80ec54ccc1bccdd7982718389baa01d304e307137540762a6660de66e1cdd6982418389baa01d375a609060e26ea80ec54ccc1bccdc39bad304f3071375403a6eb4c140c1c4dd501d8a99983799b8f375c60e860ea60ea60ea60ea60ea60ea60ea60ea60ea60ea60ea60e26ea8074dd7182b98389baa03b13370e6eb4c158c1c4dd500e99b80375a60ac60e26ea80ed200114a029405280a5014a029405280a5014a02a6660de66e24c16cdd6182818389baa01d375a609e60e26ea807454ccc1bcc8cc004004dd6182898391baa01e22533307400114a2264a6660e464a6660e660ac6eb8c15cc1d4dd50008a999839982b1bae305b307537540022660b26eb0c168c1d4dd50381bae305b307537540022940528183b8010998018018008a5030770011533306f533306f3068375a609a60e26ea80745288a99983798341bad30643071375403a294454ccc1bcccc1bcc1a0cdc3182e9bad30563071375403a6eb4c134c1c4dd500ea504a229444c8cc004004dd6182798391baa01e22533307400114a2264a6660e464660a008c4a6660e866ebcc164c1d8dd50009ba6325333075306e00114bd6f7b6300991919800800a5eb7bdb180894ccc1ec0044cc1f0cdd82601014000374c00697adef6c60132323232533307c3372091010000213308001337609801014000374c00e00a2a6660f866e3d2210000213308001337609801014000374c00e0062661000266ec0dd48011ba600133006006003375660fa0066eb8c1ec008c1fc008c1f4004c8cc0040052f5bded8c044a6660f40022660f666ec13001014000375000697adef6c60132323232533307b3372091010000213307f337609801014000375000e00a2a6660f666e3d2210000213307f337609801014000375000e0062660fe66ec0dd48011ba800133006006003375a60f80066eb8c1e8008c1f8008c1f0004cdc19bad30693076375404460ba6eb0c14cc1d8dd5011099baf30583076375460b060ec6ea8004c1accc1e0dd480125eb805281bae307700213300300300114a060ee0022646609a08e464646466e3cdc919b8a0023337929412004001005375a60f060f20046eb8c1dc004c1ccdd5182a98399baa001375c60a660e26ea80745280a5014a029405280a5014a029404c94ccc1c0c1a4c1c4dd500089919191919191919299983d983f00109982d00091299983e8010980618400080689918011840808019b99375c60fe0042c6eb0c1f0004c1f0008dd7183d000983d0011b99375c60f000260f00046eb8c1d8004c1c8dd50008b183a0010991801183a0019bae307200216375c60de00260de0046eb4c1b4004c1b4008dd6183580098358011bad30690013069002375a60ce00260ce0046eb0c194004c194008dd6983180098318011bad30610013061002375c60be00260be0046eb8c174004c174008dd7182d800982d8011bae3059001305537540022c60ae60a86ea800458c0e4c14cdd5000982a98291baa00116302b001163303d021233304f3375e606e60a26ea800530103d87980004a094458dd6181898279baa019161613230023054003375c60a4004264600460a40066eb8c14000858dd6982680098268011bad304b001304b002375a609200260920046eb0c11c004c11c008dd6982280098228011bad30430013043002375c608200260820046eb8c0fc004c0fc008dd7181e800981e8011bac303b001303737540022c6072606c6ea800458c06cc0d4dd5180c181a9baa0013037303437540022c601a00c2c6eb8c0d4c0c8dd50008b180d0008b1bac30333034303430343034303430340023758606400260640046eb0c0c0004c0c0008dd6181700098151baa0252302d302e302e302e302e302e302e302e0012302c302d302d302d001222325333029301d302a37540022900009bad302e302b375400264a666052603a60546ea80045300103d87a8000132330010013756605e60586ea8008894ccc0b8004530103d87a8000132323232533302f337220100042a66605e66e3c0200084c098cc0ccdd4000a5eb80530103d87a8000133006006003375a60600066eb8c0b8008c0c8008c0c0004cc07800c00894ccc0a0004530103d87a80001301c33029302a0014bd701119198008008019129998150008a5013253330283004302d00214a2266006006002605a00246050605260526052605260520024604e6050605060506050605060500024604c604e604e604e604e604e604e604e604e604e604e0024604a604c604c604c604c604c604c604c604c604c00244646600200200644660060026004004466e212000371a0024604400246042604400244646600200200644a66604200229404c94ccc07ccdc79bae302400200414a226600600600260480024603e604060406040604060406040604060400022a66603266e1d200100913232533301b301430073300a37586040004466603866ebcc010c078dd5000a60103d87980004a094454ccc06cc03cc0100044c94ccc070c054c074dd5000899b8f00d375c6042603c6ea800458c0180045858dd6180f981018101810181018101810000980f980f980d9baa016162301e301f301f001300100122533301b0011480004c018cc008008c07800494ccc0640045300103d87a80001300d3301a301b0014bd70180080091299980c0008a4000260066600400460360026e01200222323300100100322533301800114bd7009919299980b980280109980d80119802002000899802002000980e001180d0009bad3012002375c60200022c602600264a66601c6004601e6ea800452f5bded8c026eacc04cc040dd5000998019bab3002300f375401400a6e1d200223011301230123012301200122323300100100322533301100114c103d87a800013232323253330123372200e0042a66602466e3c01c0084c024cc058dd3000a5eb80530103d87a8000133006006003375660260066eb8c044008c054008c04c004dd2a40006eb8c034c028dd50011b874800058c02cc030008c028004c028008c020004c010dd50008a4c26cacae6955ceaab9e5573eae815d0aba21";
        }
        return "590b9301010032323232323232253330023232323232533233008300130093754004264646464646464a666024602a004264646464646464646464a666032601a012264646464646464646464646464646464646464646464a66605e60466030002264a666060605260626ea80044c94ccc0c4c094c0740184c94ccc0c8c0acc0ccdd500089919299981a19b8748010c0d4dd5000899299981a9817181b1baa00113232323232323232323232323232323232323232533304c304f00213302b01322533304e00213302d0092253330500021533304d304133302837566064609e6ea8c0c8c13cdd500da451cd3c25617941168e238038f1cf6542229b919bbd6fd2b8292ce17620300375c606a609e6ea806454ccc134cdd7981898279baa3031304f37546064609e6ea806ccdd2a4004660a298011e581cd3c25617941168e238038f1cf6542229b919bbd6fd2b8292ce176203004bd70099299982729998271823981b8008a5113303400101e132533304f3043303b001132533305030493051375400226464a6660a466e1d200430533754002264a6660a6609860a86ea80044c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c94ccc1b8c1c40084cc13402c894ccc1c00084cc13c01c894ccc1c800854ccc1bccdc781f9bae30543071375403a2a6660de60c66660946eacc150c1c4dd500f83381f8a99983799baf30533071375460a660e26ea807ccdd2a4004660e6609260e26ea80752f5c02a6660de664464a6660e460cc60e66ea80044c94ccc1ccc19cc1d0dd5182c183a9baa305830753754008266e2000400c4cdc48008019bad3077307437540022940c154c1ccdd5182b18399baa0023048307137540d86eb4c120c1c4dd500e8a999837a99983799b8f375c60a860e26ea80740fc54ccc1bccdc79bae30573071375403a6eb8c150c1c4dd501d8a99983799b8f375c609260e26ea8074dd7182498389baa03b1533306f3370e6eb4c190c1c4dd500e9bad3064307137540762a6660de66e1cdd6982698389baa01d375a609a60e26ea80ec54ccc1bccdd7982718389baa01d304e307137540762a6660de66e1cdd6982418389baa01d375a609060e26ea80ec54ccc1bccdc39bad304f3071375403a6eb4c140c1c4dd501d8a99983799b8f375c60e860ea60ea60ea60ea60ea60ea60ea60ea60ea60ea60ea60e26ea8074dd7182b98389baa03b13370e6eb4c158c1c4dd500e99b80375a60ac60e26ea80ed200114a029405280a5014a029405280a5014a02a6660de66e24c16cdd6182818389baa01d375a609e60e26ea807454ccc1bcc8cc004004dd6182898391baa01e22533307400114a2264a6660e464a6660e660ac6eb8c15cc1d4dd50008a999839982b1bae305b307537540022660b26eb0c168c1d4dd50381bae305b307537540022940528183b8010998018018008a5030770011533306f533306f3068375a609a60e26ea80745288a99983798341bad30643071375403a294454ccc1bcccc1bcc1a0cdc3182e9bad30563071375403a6eb4c134c1c4dd500ea504a229444c8cc004004dd6182798391baa01e22533307400114a2264a6660e464660a008c4a6660e866ebcc164c1d8dd50009ba6325333075306e00114bd6f7b6300991919800800a5eb7bdb180894ccc1ec0044cc1f0cdd82601014000374c00697adef6c60132323232533307c3372091010000213308001337609801014000374c00e00a2a6660f866e3d2210000213308001337609801014000374c00e0062661000266ec0dd48011ba600133006006003375660fa0066eb8c1ec008c1fc008c1f4004c8cc0040052f5bded8c044a6660f40022660f666ec13001014000375000697adef6c60132323232533307b3372091010000213307f337609801014000375000e00a2a6660f666e3d2210000213307f337609801014000375000e0062660fe66ec0dd48011ba800133006006003375a60f80066eb8c1e8008c1f8008c1f0004cdc19bad30693076375404460ba6eb0c14cc1d8dd5011099baf30583076375460b060ec6ea8004c1accc1e0dd480125eb805281bae307700213300300300114a060ee0022646609a08e464646466e3cdc919b8a0023337929412004001005375a60f060f20046eb8c1dc004c1ccdd5182a98399baa001375c60a660e26ea80745280a5014a029405280a5014a029404c94ccc1c0c1a4c1c4dd500089919191919191919299983d983f00109982d00091299983e8010980618400080689918011840808019b99375c60fe0042c6eb0c1f0004c1f0008dd7183d000983d0011b99375c60f000260f00046eb8c1d8004c1c8dd50008b183a0010991801183a0019bae307200216375c60de00260de0046eb4c1b4004c1b4008dd6183580098358011bad30690013069002375a60ce00260ce0046eb0c194004c194008dd6983180098318011bad30610013061002375c60be00260be0046eb8c174004c174008dd7182d800982d8011bae3059001305537540022c60ae60a86ea800458c0e4c14cdd5000982a98291baa00116302b001163303d021233304f3375e606e60a26ea800530103d87980004a094458dd6181898279baa019161613230023054003375c60a4004264600460a40066eb8c14000858dd6982680098268011bad304b001304b002375a609200260920046eb0c11c004c11c008dd6982280098228011bad30430013043002375c608200260820046eb8c0fc004c0fc008dd7181e800981e8011bac303b001303737540022c6072606c6ea800458c06cc0d4dd5180c181a9baa0013037303437540022c601a00c2c6eb8c0d4c0c8dd50008b180d0008b1bac30333034303430343034303430340023758606400260640046eb0c0c0004c0c0008dd6181700098151baa0252302d302e302e302e302e302e302e302e0012302c302d302d302d001222325333029301d302a37540022900009bad302e302b375400264a666052603a60546ea80045300103d87a8000132330010013756605e60586ea8008894ccc0b8004530103d87a8000132323232533302f337220100042a66605e66e3c0200084c098cc0ccdd4000a5eb80530103d87a8000133006006003375a60600066eb8c0b8008c0c8008c0c0004cc07800c00894ccc0a0004530103d87a80001301c33029302a0014bd701119198008008019129998150008a5013253330283004302d00214a2266006006002605a00246050605260526052605260520024604e6050605060506050605060500024604c604e604e604e604e604e604e604e604e604e604e0024604a604c604c604c604c604c604c604c604c604c00244646600200200644660060026004004466e212000371a0024604400246042604400244646600200200644a66604200229404c94ccc07ccdc79bae302400200414a226600600600260480024603e604060406040604060406040604060400022a66603266e1d200100913232533301b301430073300a37586040004466603866ebcc010c078dd5000a60103d87980004a094454ccc06cc03cc0100044c94ccc070c054c074dd5000899b8f00d375c6042603c6ea800458c0180045858dd6180f981018101810181018101810000980f980f980d9baa016162301e301f301f001300100122533301b0011480004c018cc008008c07800494ccc0640045300103d87a80001300d3301a301b0014bd70180080091299980c0008a4000260066600400460360026e01200222323300100100322533301800114bd7009919299980b980280109980d80119802002000899802002000980e001180d0009bad3012002375c60200022c602600264a66601c6004601e6ea800452f5bded8c026eacc04cc040dd5000998019bab3002300f375401400a6e1d200223011301230123012301200122323300100100322533301100114c103d87a800013232323253330123372200e0042a66602466e3c01c0084c024cc058dd3000a5eb80530103d87a8000133006006003375660260066eb8c044008c054008c04c004dd2a40006eb8c034c028dd50011b874800058c02cc030008c028004c028008c020004c010dd50008a4c26cacae6955ceaab9e5573eae815d0aba21";
    }

    public static String getMintStateTokenHash(CardanoNetwork network) {
        if (network.equals(CardanoNetwork.MAINNET)) {
            return "1919c122cba719a9bf760e4e463bbcf8a3d46327569cdb5edd8b7d0e";
        }
        return "6b3a786359bfb307baa3be8cc4fa9872c219c42b76226a4f97d90a62";
    }

    public static String getUpdateStateTokenCode(CardanoNetwork network) {
        if (network.equals(CardanoNetwork.MAINNET)) {
            return "590b3a01010032323232323232253330023232323232533233008300130093754004264646646464646464646464646464646464646464646464646464646446464a66604e600e60506ea80044c8c94ccc0a4cdc3a400860546ea80044c8cc02400454ccc0a8c08cc060dd6181018161baa0271533302a3375e60106eb0c080c0b0dd5013980919817180f98161baa0014bd700a99981518119998039bab301f302c3754603e60586ea800d2211c1919c122cba719a9bf760e4e463bbcf8a3d46327569cdb5edd8b7d0e00375c603e60586ea80044c8c94ccc0b0c0940044c8c94ccc0b8c038c0bcdd50008992999817981418088028992999818180818189baa00113253330313375e604860666ea8004c090c0ccdd5181318199baa00313253330323370e900218199baa0011323301200115333033302c33301037566050606a6ea800d22011c1919c122cba719a9bf760e4e463bbcf8a3d46327569cdb5edd8b7d0e00375c6050606a6ea80284c8c94ccc0d4c94ccc0d8cdc4240006eb4c0b0c0e0dd500689919299981c1818981c9baa00113253330393032303a3754605c60766ea8c0b8c0ecdd5002099b880010031337120020066eb4c0f4c0e8dd50008a50302a30393754605860726ea8008dd6980d181c1baa00d14a06032606e6ea80c854ccc0d400854ccc0d400454ccc0d4cdc4980b9bac301a303737540066eb4c06cc0dcdd5001899198008009bac301b3038375400844a66607400229444c94ccc0e0c94ccc0e4c0acdd71816181d9baa00115333039302b375c605a60766ea80044c8c8cc004004dd61818981e9baa03822533303f00114a0264a66607a66e3cdd718210010020a511330030030013042001375c605a60766ea80045280a50303d00213300300300114a0607a00229405280a5014a0a66606860286eb4c07cc0d8dd50010a51153330343014375a603c606c6ea80085288a99981a19981a180a19b863024375a6054606c6ea8008dd6980f981b1baa0024a0944528899198008009bac30213037375400644a66607200229444c94ccc0dcc8c8cc004004034894ccc0f4004528099299981d99299981e19baf3031303e37540026e98c94ccc0f4c07400452f5bded8c0264646600200297adef6c60225333043001133044337609801014000374c00697adef6c60132323232533304433720910100002133048337609801014000374c00e00a2a66608866e3d22100002133048337609801014000374c00e00626609066ec0dd48011ba6001330060060033756608a0066eb8c10c008c11c008c114004c8cc0040052f5bded8c044a66608400226608666ec13001014000375000697adef6c60132323232533304333720910100002133047337609801014000375000e00a2a66608666e3d22100002133047337609801014000375000e00626608e66ec0dd48011ba800133006006003375a60880066eb8c108008c118008c110004cdc19bad3026303e375401460546eb0c0a0c0f8dd5005099baf302f303e3754605e607c6ea8004c090cc100dd4802a5eb8052818200010a511330030030013040001375c60780042660060060022940c0f00054ccc0cccdc79bae3026303537540026eb8c098c0d4dd50050a99981999b8f375c6050606a6ea8004dd71814181a9baa00a153330333371e6eb8c09cc0d4dd50009bae3027303537540142a66606666e3cdd7180e181a9baa001375c6038606a6ea802854ccc0cccdc39bad301d303537540026eb4c074c0d4dd50050a99981999b87375a603c606a6ea8004dd6980f181a9baa00a153330333375e603e606a6ea8004c07cc0d4dd50050a99981999b87375a602e606a6ea8004dd6980b981a9baa00a153330333370e6eb4c064c0d4dd50009bad3019303537540142a66606666e3cdd71810181a9baa001375c6040606a6ea80284cdc39bad30293035375400266e00dd69814981a9baa00a480045280a5014a029405280a5014a029405280a50163037303437540022c604a60666ea800458c0d4c0c8dd50008b29998190028a60103d87a8000130173303330340054bd700b181998181baa001163300e37586040605e6ea80a8024dd618189819181918171baa0291533302c300c0011533302c300c300e0021533302c3025301a37586044605c6ea80a44c94ccc0b4c034c0b8dd500089919192999819981b001099299981899b87375a606600490008a99981899b8f00100413371e6eb8c098c0ccdd50040020a5014a06eb8c0c400458c0d0004c94ccc0bcc0a0c0c0dd50008a5eb7bdb1804dd5981a18189baa001330153756603060606ea80ad22011c1919c122cba719a9bf760e4e463bbcf8a3d46327569cdb5edd8b7d0e00375c6064605e6ea800458c028dd6181118171baa0291614a02c646600200200e44a6660600022900009991299981798141998061bab30243031375400491011c1919c122cba719a9bf760e4e463bbcf8a3d46327569cdb5edd8b7d0e00375c604860626ea80184c07c0044004c0c8004cc008008c0cc004c8cc004004018894ccc0bc00452f5c026464a66605c66605c66ebcc088c0c0dd500126103d87980004a09444cc0c8008cc0100100044cc010010004c0cc008c0c4004585858c0b8c0acdd50008b180e18151baa301d302a3754002605860526ea800458cc01cdd6180c98141baa0230023758605460566056604e6ea8088888c94ccc09cc080c0a0dd50008a400026eb4c0b0c0a4dd5000992999813981018141baa00114c103d87a8000132330010013756605a60546ea8008894ccc0b0004530103d87a8000132323232533302d337220100042a66605a66e3c0200084c054cc0c4dd4000a5eb80530103d87a8000133006006003375a605c0066eb8c0b0008c0c0008c0b8004cc03400c00894ccc098004530103d87a80001300b3302730280014bd70112999811980198121baa0021323232323232323232323232323232323232323232323232533303e304100213302c00b22533304000213302e0072253330420021501d132533304030203041375400226464646464646464a666096609c00426607200244a66609a0042601860a001a264600460a20066e64dd718278010b1bac304c001304c002375c609400260940046e64dd7182400098240011bae3046001304237540022c6088004264600460880066eb8c10800858dd7181f800981f8011bad303d001303d0023758607600260760046eb4c0e4004c0e4008dd6981b800981b8011bac30350013035002375a606600260660046eb4c0c4004c0c4008dd7181780098178011bae302d001302d002375c605600260560046eb8c0a4004c094dd50010b1b874800088c8cc00400400c894ccc098004530103d87a80001323253330253375e6030604e6ea80080144c034cc0a40092f5c026600800800260540046050002600200244a6660440022900009807998010011812800918111811981198119811981198119811800918109811181118111811181118111811181118110009181018109810981098109810981098109810981098108009119198008008019129998100008a6103d87a800013232323253330213372200e0042a66604266e3c01c0084c024cc094dd3000a5eb80530103d87a8000133006006003375660440066eb8c080008c090008c088004dd2a40004603a603c603c603c00246038603a603a603a603a0024603660386038603860386038002460346036603660366036603660360024603260346034603460346034603460346034603460346034002600200244a66602c002290000980199801001180c8009b804800888c8cc00400400c88cc00c004c0080088cdc4240006e340048c04c0048c048c04cc04c0048c044c0480048c040c044c044c044c044c044c044c044c044004c03c008c038c03c004c028dd50011b874800858c02cc030008c028004c028008c020004c010dd50008a4c26cacae6955ceaab9e5573eae815d0aba21";
        }
        return "590b3a01010032323232323232253330023232323232533233008300130093754004264646646464646464646464646464646464646464646464646464646446464a66604e600e60506ea80044c8c94ccc0a4cdc3a400860546ea80044c8cc02400454ccc0a8c08cc060dd6181018161baa0271533302a3375e60106eb0c080c0b0dd5013980919817180f98161baa0014bd700a99981518119998039bab301f302c3754603e60586ea800d2211c6b3a786359bfb307baa3be8cc4fa9872c219c42b76226a4f97d90a6200375c603e60586ea80044c8c94ccc0b0c0940044c8c94ccc0b8c038c0bcdd50008992999817981418088028992999818180818189baa00113253330313375e604860666ea8004c090c0ccdd5181318199baa00313253330323370e900218199baa0011323301200115333033302c33301037566050606a6ea800d22011c6b3a786359bfb307baa3be8cc4fa9872c219c42b76226a4f97d90a6200375c6050606a6ea80284c8c94ccc0d4c94ccc0d8cdc4240006eb4c0b0c0e0dd500689919299981c1818981c9baa00113253330393032303a3754605c60766ea8c0b8c0ecdd5002099b880010031337120020066eb4c0f4c0e8dd50008a50302a30393754605860726ea8008dd6980d181c1baa00d14a06032606e6ea80c854ccc0d400854ccc0d400454ccc0d4cdc4980b9bac301a303737540066eb4c06cc0dcdd5001899198008009bac301b3038375400844a66607400229444c94ccc0e0c94ccc0e4c0acdd71816181d9baa00115333039302b375c605a60766ea80044c8c8cc004004dd61818981e9baa03822533303f00114a0264a66607a66e3cdd718210010020a511330030030013042001375c605a60766ea80045280a50303d00213300300300114a0607a00229405280a5014a0a66606860286eb4c07cc0d8dd50010a51153330343014375a603c606c6ea80085288a99981a19981a180a19b863024375a6054606c6ea8008dd6980f981b1baa0024a0944528899198008009bac30213037375400644a66607200229444c94ccc0dcc8c8cc004004034894ccc0f4004528099299981d99299981e19baf3031303e37540026e98c94ccc0f4c07400452f5bded8c0264646600200297adef6c60225333043001133044337609801014000374c00697adef6c60132323232533304433720910100002133048337609801014000374c00e00a2a66608866e3d22100002133048337609801014000374c00e00626609066ec0dd48011ba6001330060060033756608a0066eb8c10c008c11c008c114004c8cc0040052f5bded8c044a66608400226608666ec13001014000375000697adef6c60132323232533304333720910100002133047337609801014000375000e00a2a66608666e3d22100002133047337609801014000375000e00626608e66ec0dd48011ba800133006006003375a60880066eb8c108008c118008c110004cdc19bad3026303e375401460546eb0c0a0c0f8dd5005099baf302f303e3754605e607c6ea8004c090cc100dd4802a5eb8052818200010a511330030030013040001375c60780042660060060022940c0f00054ccc0cccdc79bae3026303537540026eb8c098c0d4dd50050a99981999b8f375c6050606a6ea8004dd71814181a9baa00a153330333371e6eb8c09cc0d4dd50009bae3027303537540142a66606666e3cdd7180e181a9baa001375c6038606a6ea802854ccc0cccdc39bad301d303537540026eb4c074c0d4dd50050a99981999b87375a603c606a6ea8004dd6980f181a9baa00a153330333375e603e606a6ea8004c07cc0d4dd50050a99981999b87375a602e606a6ea8004dd6980b981a9baa00a153330333370e6eb4c064c0d4dd50009bad3019303537540142a66606666e3cdd71810181a9baa001375c6040606a6ea80284cdc39bad30293035375400266e00dd69814981a9baa00a480045280a5014a029405280a5014a029405280a50163037303437540022c604a60666ea800458c0d4c0c8dd50008b29998190028a60103d87a8000130173303330340054bd700b181998181baa001163300e37586040605e6ea80a8024dd618189819181918171baa0291533302c300c0011533302c300c300e0021533302c3025301a37586044605c6ea80a44c94ccc0b4c034c0b8dd500089919192999819981b001099299981899b87375a606600490008a99981899b8f00100413371e6eb8c098c0ccdd50040020a5014a06eb8c0c400458c0d0004c94ccc0bcc0a0c0c0dd50008a5eb7bdb1804dd5981a18189baa001330153756603060606ea80ad22011c6b3a786359bfb307baa3be8cc4fa9872c219c42b76226a4f97d90a6200375c6064605e6ea800458c028dd6181118171baa0291614a02c646600200200e44a6660600022900009991299981798141998061bab30243031375400491011c6b3a786359bfb307baa3be8cc4fa9872c219c42b76226a4f97d90a6200375c604860626ea80184c07c0044004c0c8004cc008008c0cc004c8cc004004018894ccc0bc00452f5c026464a66605c66605c66ebcc088c0c0dd500126103d87980004a09444cc0c8008cc0100100044cc010010004c0cc008c0c4004585858c0b8c0acdd50008b180e18151baa301d302a3754002605860526ea800458cc01cdd6180c98141baa0230023758605460566056604e6ea8088888c94ccc09cc080c0a0dd50008a400026eb4c0b0c0a4dd5000992999813981018141baa00114c103d87a8000132330010013756605a60546ea8008894ccc0b0004530103d87a8000132323232533302d337220100042a66605a66e3c0200084c054cc0c4dd4000a5eb80530103d87a8000133006006003375a605c0066eb8c0b0008c0c0008c0b8004cc03400c00894ccc098004530103d87a80001300b3302730280014bd70112999811980198121baa0021323232323232323232323232323232323232323232323232533303e304100213302c00b22533304000213302e0072253330420021501d132533304030203041375400226464646464646464a666096609c00426607200244a66609a0042601860a001a264600460a20066e64dd718278010b1bac304c001304c002375c609400260940046e64dd7182400098240011bae3046001304237540022c6088004264600460880066eb8c10800858dd7181f800981f8011bad303d001303d0023758607600260760046eb4c0e4004c0e4008dd6981b800981b8011bac30350013035002375a606600260660046eb4c0c4004c0c4008dd7181780098178011bae302d001302d002375c605600260560046eb8c0a4004c094dd50010b1b874800088c8cc00400400c894ccc098004530103d87a80001323253330253375e6030604e6ea80080144c034cc0a40092f5c026600800800260540046050002600200244a6660440022900009807998010011812800918111811981198119811981198119811800918109811181118111811181118111811181118110009181018109810981098109810981098109810981098108009119198008008019129998100008a6103d87a800013232323253330213372200e0042a66604266e3c01c0084c024cc094dd3000a5eb80530103d87a8000133006006003375660440066eb8c080008c090008c088004dd2a40004603a603c603c603c00246038603a603a603a603a0024603660386038603860386038002460346036603660366036603660360024603260346034603460346034603460346034603460346034002600200244a66602c002290000980199801001180c8009b804800888c8cc00400400c88cc00c004c0080088cdc4240006e340048c04c0048c048c04cc04c0048c044c0480048c040c044c044c044c044c044c044c044c044004c03c008c038c03c004c028dd50011b874800858c02cc030008c028004c028008c020004c010dd50008a4c26cacae6955ceaab9e5573eae815d0aba21";
    }

    public static String getUpdateStateTokenHash(CardanoNetwork network) {
        if (network.equals(CardanoNetwork.MAINNET)) {
            return "314cdf9ea60ee354ff1b87da74f15dedd4070604b2819a1d6bac3453";
        }
        return "f2f25cfcc4e1665bad2477fc1aa6e9960ae59ef1681eae28a0bfed16";
    }

    public static Optional<Utxo> getUtxoByTransactionAndUnit(String transactionHash, String unit, BackendService backendService) {
        Result<TxContentUtxo> transactionUtxos;
        try {
            transactionUtxos = backendService.getTransactionService().getTransactionUtxos(transactionHash);
        } catch (ApiException e) {
            log.error("Error getting transaction utxos: {}", e.getMessage());
            return Optional.empty();
        }

        if (transactionUtxos.isSuccessful()) {
            for (TxContentUtxoOutputs output : transactionUtxos.getValue().getOutputs()) {
                Optional<TxContentOutputAmount> outputWithUnit = output.getAmount().stream().filter(amount -> amount.getUnit().equals(unit)).findFirst();
                if (outputWithUnit.isPresent()) {
                    return Optional.of(output.toUtxos(transactionHash));
                }
            }
        } else {
            log.error("Error getting transaction utxos: {}", transactionUtxos.getResponse());
        }

        return Optional.empty();
    }

    public static String extractStringFromPlutusData(PlutusData plutusData) {
        return new String(((BytesPlutusData) plutusData).getValue());
    }

    public static String extractByteArrayFromPlutusData(PlutusData plutusData) {
        return HexUtil.encodeHexString(((BytesPlutusData) plutusData).getValue());
    }

    public static List<byte[]> extractListFromPlutusData(PlutusData plutusData) {
        return ((ListPlutusData) plutusData).getPlutusDataList().stream()
                .map(item -> ((BytesPlutusData) item).getValue())
                .collect(Collectors.toList());
    }

    public static Integer extractIntegerFromPlutusData(PlutusData plutusData) {
        return ((BigIntPlutusData) plutusData).getValue().intValue();
    }

    public static Boolean extractBooleanFromPlutusData(PlutusData plutusData) {
        return ((ConstrPlutusData) plutusData).getAlternative() == 1;
    }

    public static Long extractLongFromPlutusData(PlutusData plutusData) {
        return ((BigIntPlutusData) plutusData).getValue().longValue();
    }

    public static boolean includesStateToken(TransactionOutput output) {
        return output.getValue().getMultiAssets().stream().anyMatch(
                asset -> asset.getPolicyId() != null && asset.getPolicyId().equalsIgnoreCase(getMintStateTokenHash(CardanoNetwork.MAINNET))
                        || asset.getPolicyId().equalsIgnoreCase(getMintStateTokenHash(CardanoNetwork.PREPROD))
        );
    }

    public static boolean includesStateToken(AddressUtxo addressUtxo, CardanoNetwork network) {
        return addressUtxo.getAmounts().stream()
                .anyMatch(asset -> asset.getPolicyId() != null && asset.getPolicyId().equals(ValidatorUtils.getMintStateTokenHash(network)));

    }

    public static boolean includesBootstrapToken(AddressUtxo addressUtxo, CardanoNetwork network) {
        return addressUtxo.getAmounts().stream()
                .anyMatch(asset -> asset.getPolicyId() != null && asset.getPolicyId().equals(ValidatorUtils.getMintOrBurnAuthTokenHash(network)));
    }

    public static boolean isMintingTransaction(AddressUtxo addressUtxo, String policyId) {
        return addressUtxo.getAmounts().stream()
                .anyMatch(input -> input.getPolicyId() != null && input.getPolicyId().equals(policyId) &&
                        input.getQuantity().equals(BigInteger.ONE));
    }

    public static boolean isBurningTransaction(AddressUtxo addressUtxo, String policyId) {
        return addressUtxo.getAmounts().stream()
                .anyMatch(input -> input.getPolicyId() != null && input.getPolicyId().equals(policyId) &&
                        input.getQuantity().equals(BigInteger.valueOf(-1)));
    }

    public static String getBootstrapTokenName(AddressUtxo addressUtxo, CardanoNetwork network) {
        return addressUtxo.getAmounts().stream()
                .filter(input -> input.getPolicyId() != null && input.getPolicyId().equals(getMintOrBurnAuthTokenHash(network)))
                .findFirst()
                .map(Amt::getAssetName)
                .orElseThrow(() -> new IllegalArgumentException("Bootstrap token not found"));
    }
}
